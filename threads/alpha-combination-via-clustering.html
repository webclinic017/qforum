<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
alpha combination via clustering
</title>
<meta content='Here&#39;s a snapshot of an algo I&#39;ve been working on that uses clustering to determine the alpha factor weights (if I&#39;ve done things correctly).  The basic weighting scheme is that if a cluster has N alpha factors in it, each factor in the cluster gets a weight of 1/N.  The M factors are combined in a simple weighted sum: alpha_combined = w_0*alpha_0 + w_1*alpha_1 + w_2*alpha_2 + ... + w_M*alpha_M   Feedback and improvements welcome.  One issue I encountered is memory limitations, so if there is...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="zfLcZXEl0dmj151MFVqw69FYGc9YjxfIxG5IpTef+/+xlKoo09MDOhrKxH1atRif6dY6piJDAtNGYZPPndqZRA==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/alpha-combination-via-clustering' property='og:url'>
<meta content='alpha combination via clustering' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/alpha-combination-via-clustering' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='alpha combination via clustering' property='og:title'>
<meta content='Here&#39;s a snapshot of an algo I&#39;ve been working on that uses clustering to determine the alpha factor weights (if I&#39;ve done things correctly).  The basic weighting scheme is that if a cluster has N alpha factors in it, each factor in the cluster gets a weight of 1/N.  The M factors are combined in a simple weighted sum: alpha_combined = w_0*alpha_0 + w_1*alpha_1 + w_2*alpha_2 + ... + w_M*alpha_M   Feedback and improvements welcome.  One issue I encountered is memory limitations, so if there is...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/alpha-combination-via-clustering">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5c18b980ca98cc004482406c'>
<div class='post-container' data-post-id='5c18b980ca98cc004482406c' id='5c18b980ca98cc004482406c'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>alpha combination via clustering</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1545124224000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=alpha combination via clustering&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Falpha-combination-via-clustering%3Futm_source%3Dwebsite_share%26utm_campaign%3Dalpha-combination-via-clustering%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Falpha-combination-via-clustering%3Futm_source%3Dwebsite_share%26utm_campaign%3Dalpha-combination-via-clustering%26utm_medium%3Dlinkedin&amp;title=alpha+combination+via+clustering+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Portfolio Optimization' data-tag-id='55d33f293f6ba10061000000' href='/posts/tag/Portfolio-Optimization/newest'>Portfolio Optimization</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Asset Allocation' data-tag-id='55d33f4f3f6ba10061000001' href='/posts/tag/Asset-Allocation/newest'>Asset Allocation</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pipeline' data-tag-id='561525bcf252a59171000001' href='/posts/tag/Pipeline/newest'>Pipeline</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/alpha-combination-via-clustering?utm_source=website_share&amp;utm_campaign=alpha-combination-via-clustering&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Here&#39;s a snapshot of an algo I&#39;ve been working on that uses clustering to determine the alpha factor weights (if I&#39;ve done things correctly).  The basic weighting scheme is that if a cluster has N alpha factors in it, each factor in the cluster gets a weight of 1/N.  The M factors are combined in a simple weighted sum:</p>

<pre><code>alpha_combined = w_0*alpha_0 + w_1*alpha_1 + w_2*alpha_2 + ... + w_M*alpha_M  
</code></pre>

<p>Feedback and improvements welcome.  One issue I encountered is memory limitations, so if there is guidance in this area, it would be most appreciated.  I&#39;d also be interested in hearing from machine learning (ML) subject-matter experts on potential improvements.</p>

<p>Note that the number of clusters is presently set arbitrarily at 3 here:</p>

<pre><code>clustering = SpectralClustering(n_clusters=3,assign_labels=&quot;discretize&quot;,random_state=0).fit(alphas_flattened)  
</code></pre>

<p>There should probably be a global &quot;control&quot; set up, <code>N_CLUSTERS</code>, versus having the parameter buried in the code.</p>

<p>Note that the algo meets all of the contest criteria, so feel free to submit it just for for yucks (eventually I&#39;ll do the same, should I land on something worthy of the contest/fund).  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>109 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5c18bdf0ca98cc003e824050' id='5c18bdf0ca98cc003e824050'>
<a href='#5c18bdf0ca98cc003e824050'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1545125360000' class='quanto-date posted-at response-posted-at' href='#5c18bdf0ca98cc003e824050'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Very cool and generous of you Grant - thank you!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1e5fa95c95c9003d03556f' id='5c1e5fa95c95c9003d03556f'>
<a href='#5c1e5fa95c95c9003d03556f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1545494441000' class='quanto-date posted-at response-posted-at' href='#5c1e5fa95c95c9003d03556f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an update.  I added some smoothing of the final alpha vector after the factor weighting by clustering.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1ec4725c95c9004603582d' id='5c1ec4725c95c9004603582d'>
<a href='#5c1ec4725c95c9004603582d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1545520242000' class='quanto-date posted-at response-posted-at' href='#5c1ec4725c95c9004603582d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Grant,</p>

<p>Very impressive!! Your clean and elegant code makes it pretty easy to follow along as well, which I&#39;m grateful for. I&#39;m learning a lot from it!</p>

<p>This second algo appears to get better absolute returns as well as higher average sharpe than the first one. However, how it got there appears to be a bit bumpier (just eye-balling it), despite the higher average sharpe. I&#39;d be curious to hear your thoughts on it.</p>

<p>I&#39;m also curious if you&#39;ve done any OOS testing yet, or if you&#39;re saving that till later when you&#39;re &#39;done&#39; developing it (how do you determine this?)? It looks like you might have held back the data before 2010 possibly for OOS testing at the end?</p>

<p>Lastly, I think I have a general idea of what you&#39;re doing in the below two sets of code (the second set in before_trading_starts), but I&#39;d be super grateful if you&#39;d be willing to explain it a bit in simple terms, as if you&#39;re explaining it to a 5-year-old (my niece wants to know ;)). Especially the alpha smoothing, and why it appears you&#39;re normalizing twice? Are you filling NaNs with 0, and if so, how come you chose to forward fill with 0 and not the mean value, or drop them altogether? </p>

<pre><code>TAU = 5  
ALPHA_SMOOTH = 1-np.exp(-1.0/TAU)  
</code></pre>

<pre><code>    combined_alpha = normalize(combined_alpha)  
    context.combined_alpha = (1-ALPHA_SMOOTH)*context.combined_alpha  
    context.combined_alpha = context.combined_alpha.add(ALPHA_SMOOTH*combined_alpha,fill_value=0).dropna()  
    context.combined_alpha = normalize(context.combined_alpha)  
</code></pre>

<p>Thanks and keep up the great work!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1f5a55181905004b7c41b2' id='5c1f5a55181905004b7c41b2'>
<a href='#5c1f5a55181905004b7c41b2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1545558613000' class='quanto-date posted-at response-posted-at' href='#5c1f5a55181905004b7c41b2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Joakim -</p>

<p>Thanks for the compliments.  There&#39;s no guarantee I&#39;m not doing something completely knuckle-headed or pointless, so use the code with suspicion.</p>

<blockquote>
<p>This second algo appears to get better absolute returns as well as higher average sharpe than the first one. However, how it got there appears to be a bit bumpier (just eye-balling it), despite the higher average sharpe. I&#39;d be curious to hear your thoughts on it.</p>
</blockquote>

<p>Not sure why there are subtle differences between the two algos.  I&#39;m mainly trying to work out the architecture (including understanding code execution time and memory limitations) and to develop some sensible &quot;knobs&quot; for the alpha combination step.  I suspect that the two parameters <code>TAU</code> and <code>MIN_TURN</code> would be the ones to explore, along with seeing the effect of un-commenting these lines:</p>

<pre><code>    # set_commission(commission.PerShare(cost=0, min_trade_cost=0))  
    # set_slippage(slippage.FixedSlippage(spread=0))  
</code></pre>

<p>I have not done any OOS testing, and the data for one of the factors starts in 2010 (I think), and my understanding is that Q is not so interested in how algos perform prior to 2010.  There&#39;s a 1-year built-in Factset hold-out, and I haven&#39;t bothered to use the contest to cobble together backtests to see the overall performance since 2010.  The main focus is on the architecture; I&#39;ll eventually get back to looking at individual factors and improving the performance.</p>

<pre><code>TAU = 5  
ALPHA_SMOOTH = 1-np.exp(-1.0/TAU)  

    combined_alpha = normalize(combined_alpha)  
    context.combined_alpha = (1-ALPHA_SMOOTH)*context.combined_alpha  
    context.combined_alpha = context.combined_alpha.add(ALPHA_SMOOTH*combined_alpha,fill_value=0).dropna()  
    context.combined_alpha = normalize(context.combined_alpha)  
</code></pre>

<p>With the code above, I&#39;m implementing <a href="https://en.wikipedia.org/wiki/Exponential_smoothing" rel="nofollow">exponential smoothing</a> (assuming there isn&#39;t a bug).  The basic idea is to combine the past (<code>context.combined_alpha</code>) with the present (<code>combined_alpha</code>) via a weighted sum.  The result becomes the new past, which is then used in the future, in a recursive fashion.  The <code>ALPHA_SMOOTH</code> parameter controls the relative weight of the past to the present.</p>

<p>To make sure the recursion works properly, I&#39;m normalizing both the new alpha vector (<code>combined_alpha</code>) and the old one (<code>context.combined_alpha</code>).  This may not be necessary, but I think it is good practice, since if there is a normalization problem, things will get mucked up.</p>

<p>Have a look at <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.add.html:" rel="nofollow">https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.add.html:</a></p>

<blockquote>
<p>fill_value : Fill existing missing (NaN) values, and any new element needed for successful Series alignment, with this value before computation. If data in both corresponding Series locations is missing the result will be missing</p>
</blockquote>

<p>I don&#39;t expect there will be NaNs (but I should check) to be filled with zeros.  However, as the universe changes over time, I think one needs to set <code>fill_value = 0</code> so that the sum can be done (otherwise the stocks in <code>combined_alpha</code> will be different from those in <code>context.combined_alpha</code> and one would be trying to add apples to oranges).  The final <code>dropna()</code> is belt-and-suspenders as a final guard against NaNs causing the algo to crash (it may be unnecessary).</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1fe3a799b36e00438c0699' id='5c1fe3a799b36e00438c0699'>
<a href='#5c1fe3a799b36e00438c0699'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1545593767000' class='quanto-date posted-at response-posted-at' href='#5c1fe3a799b36e00438c0699'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Grant,</p>

<p>Thank you for taking the time to thoroughly explain and answer my questions! Really appreciate it, and like I said, Iâ€™m learning quite a bit from it! </p>

<p>Thank you and Happy Holidays!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c208adc2d25e80047267f71' id='5c208adc2d25e80047267f71'>
<a href='#5c208adc2d25e80047267f71'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb1b1e84ae2c1004a062d8e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3a64ba081bd92f018f87d0aa32cd448f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb1b1e84ae2c1004a062d8e'>Cc Mm</a>
</div>
<a UTCms='1545636572000' class='quanto-date posted-at response-posted-at' href='#5c208adc2d25e80047267f71'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Me too. Great codes. Learn from Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c20cb782d25e800412680bc' id='5c20cb782d25e800412680bc'>
<a href='#5c20cb782d25e800412680bc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1545653112000' class='quanto-date posted-at response-posted-at' href='#5c20cb782d25e800412680bc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Joakim,</p>

<p>You&#39;re welcome.  Let me know if you have further questions/comments/improvements.  Happy Holidays!</p>

<p>@ Cc -</p>

<p>Have fun.  Let me know if you have questions/comments/improvements.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c228f9d8edb150044679b1f' id='5c228f9d8edb150044679b1f'>
<a href='#5c228f9d8edb150044679b1f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1545768861000' class='quanto-date posted-at response-posted-at' href='#5c228f9d8edb150044679b1f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Great work!</p>

<blockquote>
<p>I have not done any OOS testing, and the data for one of the factors starts in 2010 (I think), and <strong>my understanding is that Q is not so interested in how algos perform prior to 2010.</strong></p>
</blockquote>

<p>How do you know this?  Was this explicitly relayed to you by some Q staff? Just wondering why they would ignore the relevance of the 2008 GFC in  the whole scheme of things!</p>

<p>Happy Holidays!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c22a84f7350c200499ba5db' id='5c22a84f7350c200499ba5db'>
<a href='#5c22a84f7350c200499ba5db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1545775183000' class='quanto-date posted-at response-posted-at' href='#5c22a84f7350c200499ba5db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ James -</p>

<p>At some point I recall Jess mentioning that starting in 2010 is the most relevant, but I&#39;d encourage you to follow up with her directly.</p>

<p>The relevance of the 2008 GFC is only important if one expects it to happen again soon, and in the same fashion, right?  I&#39;ve been trying to learn from some of Ray Dalio&#39;s stuff lately, and the concept is that we had a long-term debt crisis in 2008, but one would not necessarily expect another one just like it anytime soon.</p>

<p>Happy Holidays to you, too!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c24d2176d8e091dcd2121f2' id='5c24d2176d8e091dcd2121f2'>
<a href='#5c24d2176d8e091dcd2121f2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1545916951000' class='quanto-date posted-at response-posted-at' href='#5c24d2176d8e091dcd2121f2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,</p>

<blockquote>
<p>The relevance of the 2008 GFC is only important if one expects it to happen again soon, and in the same fashion, right? I&#39;ve been trying to learn from some of Ray Dalio&#39;s stuff lately, and the concept is that we had a long-term debt crisis in 2008, but one would not necessarily expect another one just like it anytime soon.</p>
</blockquote>

<p>It is not so much what caused the 2008 GFC that really matters but more the statistical significance of fat tails phenomena in log normal returns distribution of the market. It does happen and repeats itself which some refer to as regime changes.  Unless you take the short/medium term outlook of the market, it is pertinent to consider these regime changes. In particular, usually the inflection point of regime changes is characterized by high volatility (uncertainty) which is exploitable by mean reversing strategies and can present a very profitable scenario.   Just my two cents!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2667aeb3148e003fe5750b' id='5c2667aeb3148e003fe5750b'>
<a href='#5c2667aeb3148e003fe5750b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1546020782000' class='quanto-date posted-at response-posted-at' href='#5c2667aeb3148e003fe5750b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ James -</p>

<p>Regarding high volatility being exploitable, you might be right.  My hunch is that one might not be able to predict when all hell&#39;s gonna break lose, but once it does, there&#39;s a decent bet that it&#39;ll have a trade-able half-life.  I&#39;d read that volatility tends to persist; there would probably be a straightforward way to investigate this in the Q research platform.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c267b08aee6fb004423cf92' id='5c267b08aee6fb004423cf92'>
<a href='#5c267b08aee6fb004423cf92'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b26836d5c34c10046eba7e0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2994bdc17f1a5cb906a8efb55745ef4a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b26836d5c34c10046eba7e0'>Evan Kim</a>
</div>
<a UTCms='1546025736000' class='quanto-date posted-at response-posted-at' href='#5c267b08aee6fb004423cf92'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,</p>

<p>Thanks for sharing your algorithm. I&#39;ve spent some time studying it and have a couple questions. </p>

<ul>
<li><p>What is the reasoning behind WIN_LIMIT = 0 variable as opposed to leaving the default param limits=None when you winsorize? My understanding based off the docs is that they should do the same thing, no? If the limits are 0, the limits are none is my reasoning. </p></li>
<li><p>In the fcf Custom Factor, it looks like fof_yield_values are checked twice for a np.nan_to_num - once when you run the preprocessing method and again when you enter the parameter. It seems redundant. </p></li>
</ul>

<p>Regarding improvements, in my readings, I saw that spectral clustering is most effective when the affinity matrix is sparse and when pyamg module is used. I haven&#39;t looked too deeply into your algorithm design yet to know if your affinity matrix is sparse too similar. I haven&#39;t used pyamg,  but it looks like a promising tool based off the description.  </p>

<p><a href="https://github.com/pyamg/pyamg" rel="nofollow">https://github.com/pyamg/pyamg</a> </p>

<p>You might find some things to make your memory usage more efficient with the library. Anyways, I will follow up soon with some more ideas and comments.</p>

<p>-Evan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2748c17edc4615aa2b845c' id='5c2748c17edc4615aa2b845c'>
<a href='#5c2748c17edc4615aa2b845c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1546078401000' class='quanto-date posted-at response-posted-at' href='#5c2748c17edc4615aa2b845c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>The relevance of the 2008 GFC is only important if one expects it to happen again soon, and in the same fashion, right?</p>
</blockquote>

<p>Theoretically, I imagine Quantopian assume that if an algorithm is shown to be genuinely independent of the general market, then the direction of the market and its volatility is genuinely irrelevant. And hence no back test needs to be run during 2007 to 2009.</p>

<p>This may be correct but requires &quot;faith&quot;.  I prefer to stock my hands in the wound: if the data is there, why not try it out? As it happens this algo does comparatively well in that awful period.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2770b07edc4615aa2b853b' id='5c2770b07edc4615aa2b853b'>
<a href='#5c2770b07edc4615aa2b853b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1546088625000' class='quanto-date posted-at response-posted-at' href='#5c2770b07edc4615aa2b853b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Evan -</p>

<p>Thanks for the feedback.  Some comments:</p>

<ol>
<li>The winsorize setting of <code>winsorize(a, limits=[WIN_LIMIT,WIN_LIMIT])</code> with WIN_LIMIT = 0 should just pass though a copy of <code>a</code>.  <code>WIN_LIMIT</code> is available as a global in case one wanted to try winsorizing.<br></li>
<li>There are likely redundancies in checking for nans and infs.  I&#39;m not too systematic in managing them.  This should be on a TO DO list at the top of the algo.<br></li>
<li>I more-or-less just threw in the spectral clustering without much research.  Clustering, in general, would seem like a nice way to do diversification, but maybe it just leads to a lot of noise if the right clustering algo isn&#39;t used?  It would probably be more effective to explore in the Q research platform, if you are so inclined.<br></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3e463fc48ba90047c6ae1f' id='5c3e463fc48ba90047c6ae1f'>
<a href='#5c3e463fc48ba90047c6ae1f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1547585087000' class='quanto-date posted-at response-posted-at' href='#5c3e463fc48ba90047c6ae1f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for this nice algo!</p>

<p>About memory usage:<br>
pyamg will very probably not help for memory usage, as it is just a multigrid solver... It will just speed up the computation of the clustering (with also introducing some error... efficiency come always with a cost!)<br>
I am also facing some memory limitation when I deal with quite large amount of alphas with a window (storing the alphas of the past days). A solution I found effective is to store the past alpha in a pd dataframe (in context) enforcing the usage of float32. This create a bit of time consumption (type casting from the outputs of the pipeline) but it is fine and reduce the memory usage by a factor 2 :-).</p>

<p>About optimization of your algo:<br>
You definitely store the alphas of the previous days... so you are using this memory... Creating a context variable to store the alphas of the previous days will therefore cost you the same memory. Then in your pipeline you compute everyday the alpha of the entire window, with a context variable you will only need to compute the new alpha, that will save quite some execution time of the pipeline :-).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3eb23ce598f900400880f5' id='5c3eb23ce598f900400880f5'>
<a href='#5c3eb23ce598f900400880f5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b5367af91296a14e12b76bd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0f1a8eac15a47d97473d28722fa824e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b5367af91296a14e12b76bd'>Kyle M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1547612732000' class='quanto-date posted-at response-posted-at' href='#5c3eb23ce598f900400880f5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi David,</p>

<p>Do you mind doing a simple mock-up of how this context variable can be used with pipeline to prevent redundant calculations?</p>

<p>Thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3ef6209a5876003ea2626c' id='5c3ef6209a5876003ea2626c'>
<a href='#5c3ef6209a5876003ea2626c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547630112000' class='quanto-date posted-at response-posted-at' href='#5c3ef6209a5876003ea2626c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ David -</p>

<p>Thanks for the feedback.  </p>

<p>I&#39;d be interested in the details of how you enforce the usage of float32.</p>

<p>The problem I see with accumulating data in <code>context</code> is that there will be a transient (&quot;warm-up&quot;) period until the window is full.  With Pipeline, there is an accumulation prior to the start of the algo, so the window is full from the outset.  I suppose one could try to figure out how to use Pipeline to output the trailing window at the start of the algo, but then just update it for subsequent days.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3efb59e598f900490882bd' id='5c3efb59e598f900490882bd'>
<a href='#5c3efb59e598f900490882bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1547631449000' class='quanto-date posted-at response-posted-at' href='#5c3efb59e598f900490882bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<p>Indeed the accumulating issue is a bit annoying!  With my current version I indeed have a &quot;burning phase&quot; at the beginning, a period where the algo does not trade at all, just accumulating datas...<br>
I think this is the good way of doing it: having a pipeline like yours for the initialization to fill the buffer. I will give it a try.... (In fact thats the reason I found your algo great lol, gave me the way to remove this f^#)$%&amp;# burning period ;-) )</p>

<p>Without using a buffer I dont see the way to inforce the type. I do the typecasting when I fill the buffer. Pandas has a function &quot;astype&quot; ;-). When I do the copy of the new data into the buffer i do it enforcing the new types  (series.astype(&#39;float32&#39;) ).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3f1593721dbb680fd09538' id='5c3f1593721dbb680fd09538'>
<a href='#5c3f1593721dbb680fd09538'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b83845c16cd3f004ba47d2c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5efba7ec89e08eda2940979dcb970c4e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b83845c16cd3f004ba47d2c'>Wandering Bot</a>
</div>
<a UTCms='1547638163000' class='quanto-date posted-at response-posted-at' href='#5c3f1593721dbb680fd09538'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, I am very impressed by your algorithm. While I wonder why you share your alpha publicly, I am glad I found it. I have always wanted to compute the Spearman rank correlations between next day returns and today&#39;s factors over a window and take the average. I want to use this average to combine factors based on their correlations. Would that be possible with the pipeline? I am new to this and would really appreciate your comments.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3f4abc9a58760043a26473' id='5c3f4abc9a58760043a26473'>
<a href='#5c3f4abc9a58760043a26473'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1547651772000' class='quanto-date posted-at response-posted-at' href='#5c3f4abc9a58760043a26473'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<p>Here is a verions with rolling windows + your method for the first day. I did it with the help of 2 pipeline. (you can also see the typecasting of the output_pipeline)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3fb967f74d40004b57c58b' id='5c3fb967f74d40004b57c58b'>
<a href='#5c3fb967f74d40004b57c58b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547680103000' class='quanto-date posted-at response-posted-at' href='#5c3fb967f74d40004b57c58b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Satya -</p>

<blockquote>
<p>I have always wanted to compute the Spearman rank correlations between next day returns and today&#39;s factors over a window and take the average. I want to use this average to combine factors based on their correlations. Would that be possible with the pipeline? I am new to this and would really appreciate your comments. </p>
</blockquote>

<p>Rather than doing it in Pipeline, you could use the code I posted above and do it in <code>before_trading_start</code> (instead of the clustering).  You might be able to do it within Pipeline, but I think things are easier working outside of it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c42ee54709e37003ea2628d' id='5c42ee54709e37003ea2628d'>
<a href='#5c42ee54709e37003ea2628d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b83845c16cd3f004ba47d2c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5efba7ec89e08eda2940979dcb970c4e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b83845c16cd3f004ba47d2c'>Wandering Bot</a>
</div>
<a UTCms='1547890260000' class='quanto-date posted-at response-posted-at' href='#5c42ee54709e37003ea2628d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks @ Grant. I tried a different approach where I compute the IC between a factor and returns inline with custom factor definition. But it is not working. Any advice, please?</p>

<pre><code>class MessageSum(CustomFactor):  
        inputs = [USEquityPricing.high, USEquityPricing.low, USEquityPricing.close, stocktwits.bull_scored_messages, stocktwits.bear_scored_messages, stocktwits.total_scanned_messages, Returns]  
        window_length = 21  
        window_safe = True  
        def compute(self, today, assets, out, high, low, close, bull, bear, total):  
            v = np.nansum((high-low)/close, axis=0)  
            v = preprocess(v*np.nansum(total*(bear-bull), axis=0))  
            v *= np.sign(sp.stats.spearmanr(v, Returns[-1])[0])  
            out[:] = v  
</code></pre>

<p>The above code does not work. </p>

<p>Secondly, since some factors affect different sectors/industries differently, I want to compute the IC by sector? Is that even possible with pipeline?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c42f96e709e37003ea262c6' id='5c42f96e709e37003ea262c6'>
<a href='#5c42f96e709e37003ea262c6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547893102000' class='quanto-date posted-at response-posted-at' href='#5c42f96e709e37003ea262c6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Satya -</p>

<p>I haven&#39;t done coding in Quantopian for awhile, and will probably keep things on hold.  That said, I&#39;d try to sort out how the IC is computed in Alphalens, and then reproduce it in your code.  I suspect what it is doing is finding the IC between the projected return of a long-short portfolio (weighted by the demeaned, normalized factor) and the actual return.  In addition to the trailing factor values (which I export to <code>before_trading_start</code>) you&#39;ll need the returns (which could be exported to <code>before_trading_start</code> with a another Pipeline, for example).  You also need to decide the lag (and if it will be the same for all factors, or different).  It becomes a bit of a project--but doable, I think.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c43300f709e370047a2640b' id='5c43300f709e370047a2640b'>
<a href='#5c43300f709e370047a2640b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59ea9521fe14f80006b9d04c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9050d3e63b979388d50cddd5a0cf8055?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59ea9521fe14f80006b9d04c'>Yaniv Toledano</a>
</div>
<a UTCms='1547907087000' class='quanto-date posted-at response-posted-at' href='#5c43300f709e370047a2640b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Grant</p>

<p>Aren&#39;t your 8 year factors (e.g., GM_GROWTH_8YR) just looking at 8 days ago? That is, isn&#39;t gm[-8] just gross margin 8 days before last? Shouldn&#39;t you be doing [-8*252] instead (similar to what you have done for ROA_GROWTH_2YR?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c4332d9f588020043c03172' id='5c4332d9f588020043c03172'>
<a href='#5c4332d9f588020043c03172'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547907801000' class='quanto-date posted-at response-posted-at' href='#5c4332d9f588020043c03172'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Yaniv -</p>

<p>Maybe.  I think I just lifted those from what someone else had posted.  I was more interested in scaling with a relatively large number of factors, than the quality of the factors themselves.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c4333caf588020043c03178' id='5c4333caf588020043c03178'>
<a href='#5c4333caf588020043c03178'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59ea9521fe14f80006b9d04c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9050d3e63b979388d50cddd5a0cf8055?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59ea9521fe14f80006b9d04c'>Yaniv Toledano</a>
</div>
<a UTCms='1547908042000' class='quanto-date posted-at response-posted-at' href='#5c4333caf588020043c03178'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Grant </p>

<p>Makes sense - nice work nonetheless though!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c4334dd65905400493bf07f' id='5c4334dd65905400493bf07f'>
<a href='#5c4334dd65905400493bf07f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547908317000' class='quanto-date posted-at response-posted-at' href='#5c4334dd65905400493bf07f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Yaniv -</p>

<p>If you end up learning anything, please post your insights here.  I know some folks are reluctant to share their &quot;alpha&quot; but my experience has been that it is much more fun and productive to post almost everything for feedback.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c51b896aebf8a004049d6e3' id='5c51b896aebf8a004049d6e3'>
<a href='#5c51b896aebf8a004049d6e3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584709c0d105bc4727000072'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fbbdf71510a43bd01dc2b787ecd3c797?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584709c0d105bc4727000072'>luc prieur</a>
</div>
<a UTCms='1548859542000' class='quanto-date posted-at response-posted-at' href='#5c51b896aebf8a004049d6e3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, pretty cool.  Initially, I was suspicious of the clustering part, as the algo is clustering 20 data points, each having ~10,000 (5*nb_stocks) features, but I see the point of it now.  It is trying to find which of the 20 factors are more alike and discount them accordingly.  </p>

<p>I will certainly spend some time thinking of other ways to do this and post it back.  One way would be to have 5*20 data point with nb_stocks features.   Or any other approach that increases the number of data points and reduces the amount of features.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c51be33aebf8a004049d6fc' id='5c51be33aebf8a004049d6fc'>
<a href='#5c51be33aebf8a004049d6fc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1548860979000' class='quanto-date posted-at response-posted-at' href='#5c51be33aebf8a004049d6fc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Grant,</p>

<p>Looks good :-)<br>
Re. your comment: &quot; <em>...the relevance of the 2008 GFC is only important if one expects it to happen again...</em>&quot;</p>

<p>My comment below is somewhat similar to @Zeno&#39;s, but with a slightly different take on it, as follows:<br>
Although IN THEORY EquityLS should be independent of market direction or perhaps (?) other attributes related to &quot;market regime&quot;, such as volatility, etc,  we do of course see variations in EqLS algo performance over time. A problem for us now is that, although we have had a broadly similar market regime in the US for a long time, we know that eventually something will change, market behavior will differ, and so will our algo performance. Sure this is all stating the obvious but, at least IMHO, the wider range of different market conditions over which any trading system/ algo can be tested, the better. Not because we expect the past to repeat, but simply because the wider range over which we test, the more we can hope to have at least some confidence that our system will remain robust under &quot;different&quot; conditions, whatever those unknown differences might turn out to be. I&#39;m all for testing under as wide a range of different times &amp; conditions as possible!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c52b449aa478a4f9fe8dbd6' id='5c52b449aa478a4f9fe8dbd6'>
<a href='#5c52b449aa478a4f9fe8dbd6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1548923977000' class='quanto-date posted-at response-posted-at' href='#5c52b449aa478a4f9fe8dbd6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Luc -</p>

<p>Thanks for the feedback.</p>

<blockquote>
<p>It is trying to find which of the 20 factors are more alike and discount them accordingly.</p>
</blockquote>

<p>Yes, that is the basic idea.</p>

<p>Note that I did not make any effort to determine the optimum number of clusters (which is fixed):</p>

<pre><code>clustering = SpectralClustering(n_clusters=3,assign_labels=&quot;discretize&quot;,random_state=0).fit(alphas_flattened)  
</code></pre>

<p>Presumably, the optimal number of clusters could be estimated offline.  Alternatively, maybe there are clustering algorithms that dynamically and automatically determine the optimum number of clusters?</p>

<p>One potential improvement in memory management would be to limit the number of stocks passed on to <code>before_trading_start</code> for the clustering.  Presently, it is the entire <code>QTradableStocksUS</code>.  I had started to look into cutting it down to the extremes of the alpha values, common across all factors, but haven&#39;t sorted it out.</p>

<p>There may be other memory management improvements, as well, since this seems to be a limiting factor (versus compute time, which is a quite generous 5 minutes in <code>before_trading_start</code>).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c53498c2f984b46ef32149d' id='5c53498c2f984b46ef32149d'>
<a href='#5c53498c2f984b46ef32149d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1548962188000' class='quanto-date posted-at response-posted-at' href='#5c53498c2f984b46ef32149d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<p>generous 5 minutes in before_trading_start  </p>

<blockquote>
<blockquote>
<p>I have timed my pipeline computation to be around 100 seconds for loading 1 month of data in the notebook. This algo tends to have pipeline timeout in the contest. I read that Q will compute in chunks of 3 months of data for back-test. So I assume 300 seconds for loading 3 months of data which is 5 minutes. The question is that if I run the back-test, I wont experience pipeline timeout but in the contest, it will encounter. </p>
</blockquote>
</blockquote>

<p>Do you know how to time the pipeline accurately?</p>

<p>Thanks<br>
L  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c556c32ca8d7706d105fa62' id='5c556c32ca8d7706d105fa62'>
<a href='#5c556c32ca8d7706d105fa62'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1549102130000' class='quanto-date posted-at response-posted-at' href='#5c556c32ca8d7706d105fa62'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Leo c -</p>

<p>No, not sure how to time pipeline accurately.  I also suspect that it is not entirely repeatable, since my understanding is that it pulls data periodically from one or more databases, and so there could be some congestion, depending on the load.</p>

<p>Have a look at this:</p>

<p><a href="https://www.quantopian.com/posts/before-trading-start-timeout-fix" rel="nofollow">https://www.quantopian.com/posts/before-trading-start-timeout-fix</a></p>

<p>We have 10 minutes for Pipeline (run prior to <code>before_trading_start</code>), and a separate 5 minutes for <code>before_trading_start</code>.</p>

<p>I don&#39;t really understand the Q paradigm here, since the 10 minutes for Pipeline to run effectively isn&#39;t accessible in live trading.  The 10-minute limit really applies to <em>backtests</em>, for which the Pipeline computations are chunked (126-day default Pipeline chunks, per Scott&#39;s comment <a href="https://www.quantopian.com/posts/pipeline-timeoutexception-any-hope-for-a-fix#5b295e205d6af90040043a30" rel="nofollow">here</a>).  It would seem that in live trading, even though the 10-minute Pipeline limit still applies, since a backtest must be run prior to live trading, effectively one has only (10 minutes/day)x(60 seconds/minute)/126 days = ~ 5 seconds/day.  In other words, Q algos only support ~ 5 seconds of Pipeline computations per trading day, if I&#39;m thinking about this correctly.  On the other hand, since <code>before_trading_start</code> computations are not chunked, one can access 5 minutes per trading day.  There is a 5 hour limit on contest entries per the information <a href="https://www.quantopian.com/posts/before-trading-start-timeout-fix#5b5248df91296a00472b7443" rel="nofollow">here</a>.  So, one can periodically use the full 5 minutes, but not every day (since a 2-year backtest would then take 42 hours).  It would be nice if <code>before_trading_start</code> could be scheduled, but there are work-arounds to this limitation.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c95132332ff592f3f44946b' id='5c95132332ff592f3f44946b'>
<a href='#5c95132332ff592f3f44946b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c1cfcdc4764a50045ca055b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce15ea7e32a97fed041e271fa046c73?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c1cfcdc4764a50045ca055b'>Danny Wu</a>
</div>
<a UTCms='1553273635000' class='quanto-date posted-at response-posted-at' href='#5c95132332ff592f3f44946b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for sharing Grant! </p>

<p>I&#39;m still trying to make sure I understand exactly what your algo does, but it seems like you have three separate elements of alpha:</p>

<ol>
<li>Alpha factors (i.e. what you&#39;d get equal weight of all factors -- most likely negative)<br></li>
<li>Clustering of alpha factors (i.e. combining correlated factors, and taking the average of different implementations to reduce specification risk)</li>
</ol>

<p>To me, it suggests that improving the quality of your alpha factors will still have a significant impact on your overall alpha, and the fact that &quot;throw all factors in a pan and shake&quot; worked well means that choosing high quality alpha factors would make results even better.</p>

<p>In addition, looking at your tearsheet, it appears that your algorithm adapts to underlying shifts in the market. For example, the value risk decreases around Jan/Feb 2018 as value shares became more attractive, compared to the growth rally of the previous years.</p>

<p>I am curious where this &quot;alpha factor adaptation&quot; comes from, and I wonder if this is actually the third alpha variable that generates your returns.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c9537bc37bc605163d8833b' id='5c9537bc37bc605163d8833b'>
<a href='#5c9537bc37bc605163d8833b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1553283004000' class='quanto-date posted-at response-posted-at' href='#5c9537bc37bc605163d8833b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Danny -</p>

<p>I&#39;m currently inactive on Quantopian, but glad that you found my post useful.  I can tell you that the algo was thinly researched--I just threw stuff together mainly to understand how to do the architecture and the platform limitations.  So, I wouldn&#39;t get too wrapped up on the performance side of things, as there may be over-fitting, and other bad practices at play.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd523c706459e0043f0e56c' id='5cd523c706459e0043f0e56c'>
<a href='#5cd523c706459e0043f0e56c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557472199000' class='quanto-date posted-at response-posted-at' href='#5cd523c706459e0043f0e56c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>When I clone and run the algo I posted above (<a href="https://www.quantopian.com/posts/alpha-combination-via-clustering#5c1e5fa95c95c9003d03556f" rel="nofollow">https://www.quantopian.com/posts/alpha-combination-via-clustering#5c1e5fa95c95c9003d03556f</a>), I get the error:</p>

<blockquote>
<p>Something went wrong. Sorry for the inconvenience. Try using the built-in debugger to analyze your code. If you would like help, send us an email.</p>
</blockquote>

<p>Are others getting the same thing?  Any ideas why the code won&#39;t run?  I simply cloned it and clicked &quot;Build Algorithm&quot; and pfft!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd5296006459e0040f0e5b3' id='5cd5296006459e0040f0e5b3'>
<a href='#5cd5296006459e0040f0e5b3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557473632000' class='quanto-date posted-at response-posted-at' href='#5cd5296006459e0040f0e5b3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, I get the same error message. Would have been interesting to &#39;forward test&#39; it a bit since there is now quite a bit of OOS data available since mid Dec to test on.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd5332ccac23e003e9a4481' id='5cd5332ccac23e003e9a4481'>
<a href='#5cd5332ccac23e003e9a4481'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557476140000' class='quanto-date posted-at response-posted-at' href='#5cd5332ccac23e003e9a4481'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hmm?  Guess something changed in the Q API/platform?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd538e5c229f30043232087' id='5cd538e5c229f30043232087'>
<a href='#5cd538e5c229f30043232087'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1557477605000' class='quanto-date posted-at response-posted-at' href='#5cd538e5c229f30043232087'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Try sampling start dates for any others.</p>

<pre><code>2017-12-01 05:45 WARN sklearn/preprocessing/data.py:169: UserWarning: Numerical issues were encountered when scaling the data and might not be solved. The standard deviation of the data is probably very close to 0.  
2017-12-01 05:45 WARN numpy/lib/arraysetops.py:200: FutureWarning: In the future, NAT != NAT will be True rather than False.  
2017-12-01 05:45 WARN sklearn/manifold/spectral_embedding_.py:215: UserWarning: Graph is not fully connected, spectral embedding may not work as expected.  
2017-12-11 05:45 WARN sklearn/preprocessing/data.py:153: UserWarning: Numerical issues were encountered when centering the data and might not be solved. Dataset may contain too large values. You may need to prescale your features.  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd543747267735862fc6145' id='5cd543747267735862fc6145'>
<a href='#5cd543747267735862fc6145'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557480308000' class='quanto-date posted-at response-posted-at' href='#5cd543747267735862fc6145'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Blue Seahawk -</p>

<p>Thanks...seems to be a problem with the original start date of 2010-01-01.  It runs if I shift the start date to 01/01/2017.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd551a94eb7ca0042390870' id='5cd551a94eb7ca0042390870'>
<a href='#5cd551a94eb7ca0042390870'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557483945000' class='quanto-date posted-at response-posted-at' href='#5cd551a94eb7ca0042390870'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a new backtest (no change to the code posted above).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd8336aba749d0047fd09b1' id='5cd8336aba749d0047fd09b1'>
<a href='#5cd8336aba749d0047fd09b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557672810000' class='quanto-date posted-at response-posted-at' href='#5cd8336aba749d0047fd09b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an update.  I made a few changes:</p>

<ol>
<li>Switched to KMeans clustering.<br></li>
<li>Moved the exponential alpha vector smoothing to the rebalance() function.<br></li>
<li>Implemented TargetWeights as the final optimization API objective.<br></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd833c276ca2b0047808116' id='5cd833c276ca2b0047808116'>
<a href='#5cd833c276ca2b0047808116'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557672898000' class='quanto-date posted-at response-posted-at' href='#5cd833c276ca2b0047808116'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the tear sheet for the algo immediately above.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd8f594b6b3a9003f505951' id='5cd8f594b6b3a9003f505951'>
<a href='#5cd8f594b6b3a9003f505951'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557722516000' class='quanto-date posted-at response-posted-at' href='#5cd8f594b6b3a9003f505951'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Grant,</p>

<p>Thanks  for sharing your updates! Very cool in my opinion.</p>

<p>Just a suggestion, but you may want to consider including an option to normalize some (fundamentals based) factors within each sector or industry, instead of comparing broadly across the board. For example, some companies will require more debt and/or more capital expenditures just by the nature of the business they&#39;re in, just to remain in business. Utility companies for example might need to rely on a higher level of debt and continuous incoming capital to maintain and upgrade their infrastructure (CapEx), whereas software companies will not need as much, and might have mostly operational expenses. Therefore, comparing these type of factors across the board may not be comparing &#39;apples to apples&#39; and might explain why you see continuous long exposure to some sectors (e.g. health care it looks like in the above one) and continuous short exposure to other sectors (e.g. energy in the above).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd9316176ca2b0047808cfd' id='5cd9316176ca2b0047808cfd'>
<a href='#5cd9316176ca2b0047808cfd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557737825000' class='quanto-date posted-at response-posted-at' href='#5cd9316176ca2b0047808cfd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Joakim -</p>

<p>One thing I&#39;m seeing is that due to memory constraints, I need to pare down the data passed to 
<code>before_trading_start</code> where I do the alpha combination step.  If I try to pass more than ~ 5 trailing days of data, I run out of memory.  Something like 20-30 days would be better, I think.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd93a7102d8b50040bd30f1' id='5cd93a7102d8b50040bd30f1'>
<a href='#5cd93a7102d8b50040bd30f1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557740145000' class='quanto-date posted-at response-posted-at' href='#5cd93a7102d8b50040bd30f1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>From a model architectural design, this hybrid ML (clustering) on various delayed quantamental factors appears sound and I believe this is your intention, to test the design not too much focused on the factors. With this approach, personally and in addition to Joakim&#39;s suggestions on sector/industry normalization, I would limit the number of factors to within 4-6, perhaps through feature analysis and extraction phase. The added bonus to this is you will have more memory to test longer lookback periods. Just my two cents.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd93f78fd8aa6003d3d8cad' id='5cd93f78fd8aa6003d3d8cad'>
<a href='#5cd93f78fd8aa6003d3d8cad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557741432000' class='quanto-date posted-at response-posted-at' href='#5cd93f78fd8aa6003d3d8cad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ James -</p>

<p>Yep.  Just kinda kicking the tires with the large number of factors here.  I&#39;m not sure limiting the number of factors is necessarily the way to go; judiciously combining some of them within Pipeline might be better, and then exporting the set of &quot;super factors&quot; to 
<code>before_trading_start</code> for the final alpha combination extravaganza, where one can take advantage of the full 5 minute compute window.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd9407076ca2b0047808dad' id='5cd9407076ca2b0047808dad'>
<a href='#5cd9407076ca2b0047808dad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557741680000' class='quanto-date posted-at response-posted-at' href='#5cd9407076ca2b0047808dad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, yeah whatever works for you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cd94b46fd8aa600433d8d91' id='5cd94b46fd8aa600433d8d91'>
<a href='#5cd94b46fd8aa600433d8d91'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557744454000' class='quanto-date posted-at response-posted-at' href='#5cd94b46fd8aa600433d8d91'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Personally I donâ€™t understand how the clustering works. Clusters of factors? Clustering around what? Past returns? Are the factors within the clusters equally weighted, and are the clusters also equally weighted? Whatâ€™s the advantage over doing it manually, e.g a manual Value factor cluster, Quality factor cluster, etc? </p>

<p>Regarding factor smoothing, some factors might have the highest mean IC at 5 days holding period, whereas others might have longer ideal holding periods? If one could do clusters based on peak mean IC holding period, and then smooth each cluster based on that, that might work well? Not sure if thatâ€™s possible in the IDE though. </p>

<p>Anyway, whatever youâ€™re doing it appears to be working, at least in-sample, regardless if I understand it or not.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cda04f73a4a48004de152ce' id='5cda04f73a4a48004de152ce'>
<a href='#5cda04f73a4a48004de152ce'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557791991000' class='quanto-date posted-at response-posted-at' href='#5cda04f73a4a48004de152ce'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding my thinking on using the clustering for weighting, basically it should be a way of avoiding putting too much weight on sets of factors that are similar.  For example, if factors A, B, and C are all in the same cluster, and D and E are in another cluster, then A, B, and C would get a weight of 1/3 each, and D and E would get a weight of 1/2 each.  I&#39;m not sure if I did the coding correctly, but this is the concept I had in mind.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cda0bc8597b7e0050bd9084' id='5cda0bc8597b7e0050bd9084'>
<a href='#5cda0bc8597b7e0050bd9084'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557793736000' class='quanto-date posted-at response-posted-at' href='#5cda0bc8597b7e0050bd9084'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Grant, conceptually that totally makes sense to me. </p>

<p>What are you using to &#39;cluster around&#39; to determine if factors are similar or not? Looks like you&#39;re doing this in BTS but I can&#39;t figure out what&#39;s going on (I&#39;m really bad at reading someone else&#39;s code, sorry). </p>

<p>Past returns of N_FACTOR_WINDOW might make sense, though future returns might be even better I reckon during a &#39;training period&#39; (no idea if this is possible in the IDE, as then you could potentially do data snooping into the future...).  Maybe by using an ML algorithm like KNN or K-Means Clustering? </p>

<p>Also, how would one determine the &#39;right&#39; number of clusters? Maybe by setting a minimum density of the clusters? (I&#39;m just thinking out-loud)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cda0bdfabe510454cd501d3' id='5cda0bdfabe510454cd501d3'>
<a href='#5cda0bdfabe510454cd501d3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584709c0d105bc4727000072'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fbbdf71510a43bd01dc2b787ecd3c797?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584709c0d105bc4727000072'>luc prieur</a>
</div>
<a UTCms='1557793759000' class='quanto-date posted-at response-posted-at' href='#5cda0bdfabe510454cd501d3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant,</p>

<p>The concept is pretty cool and tank you so much for sharing.    I&#39;ve played a bit with your algo and the coding is correct: it does as described.  It does makes sense that you would want factors that behave similarly over a set of stocks to be penalized and factors that are more unique to be promoted, and your algo seems to be doing just that.  However, in the end, we are not sure that the factors being promoted do work better and the ones demoted are not as good, but I guess that factors should be chosen correctly before hand.</p>

<p>From an ML point of view, I wonder how efficient the clustering is as it is training on a training set of size n-factor with nb_stocks*window_length number of features (about 1700 features for 10-20 training samples).  Usually, I would prefer seeing a lot more training samples then features, but in the end it seems to works.  </p>

<p>Finally, I have noticed that the algo seems to overfit on the initial selection of factors.  How did you end up choosing the particular factors?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cda739ec8b0f46fbf98c854' id='5cda739ec8b0f46fbf98c854'>
<a href='#5cda739ec8b0f46fbf98c854'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557820318000' class='quanto-date posted-at response-posted-at' href='#5cda739ec8b0f46fbf98c854'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Joakim -</p>

<blockquote>
<p>What are you using to &#39;cluster around&#39; to determine if factors are similar or not?</p>
</blockquote>

<p>A trailing window of the factor values (which are all normalized with 
<code>preprocess</code>).</p>

<blockquote>
<p>Also, how would one determine the &#39;right&#39; number of clusters?</p>
</blockquote>

<p>I suppose one could run a series of backtests, varying the number of clusters, and find an optimum (max Sharpe ratio?).</p>

<p>@ Luc -</p>

<p>Thanks for checking the code.  Glad you&#39;ve found it helpful.</p>

<blockquote>
<p>How did you end up choosing the particular factors?</p>
</blockquote>

<p>Some factors I had created myself, and some I&#39;d collected on Quantopian from posts and documentation/examples.  The goal was simply to have a relatively large number of them, versus having &quot;good&quot; factors.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cda8463597b7e1433bd937e' id='5cda8463597b7e1433bd937e'>
<a href='#5cda8463597b7e1433bd937e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1557824611000' class='quanto-date posted-at response-posted-at' href='#5cda8463597b7e1433bd937e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How about several alpha columns and <code>.corrwith()</code><br>
 <a href="https://www.google.com/search?q=corrwith+site:stackoverflow.com" rel="nofollow">https://www.google.com/search?q=corrwith+site:stackoverflow.com</a>  </p>

<p><em>Each stock would correlate best (or worst for shorting) with a particular alpha factor on a given day and to some degree (weight) compared to others&#39; correlations with their own particular strongest alpha match.</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdb93ab307aa54bc1b22062' id='5cdb93ab307aa54bc1b22062'>
<a href='#5cdb93ab307aa54bc1b22062'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557894059000' class='quanto-date posted-at response-posted-at' href='#5cdb93ab307aa54bc1b22062'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks @Grant, makes sense.</p>

<p>Does it use all the factors, even if a factor is clearly outside any of the N clusters?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdbd602beffae23aa65c7ad' id='5cdbd602beffae23aa65c7ad'>
<a href='#5cdbd602beffae23aa65c7ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557911042000' class='quanto-date posted-at response-posted-at' href='#5cdbd602beffae23aa65c7ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Joakim -</p>

<p>Yes, it should be putting each factor into one of N clusters (&quot;buckets&quot;).  There&#39;s nothing in the code that would reject one or more factors (by setting weights to zero).</p>

<p>One problem I need to understand is the rather severe memory limitation.  For example, this appears to be about the limit:</p>

<p>n_factors = 40<br>
n_stocks = 2120<br>
N_FACTOR_WINDOW = 6</p>

<p>This is 508800 values, which for a 16 byte 64-bit float, is ~ 8 MB, which isn&#39;t much.  However, if Pipeline 6-month chunking is included (6 months x 20 days per month), it puts it at ~ 1 GB, which is sort of within the ballpark of the 8 GB of RAM allocated (I recall seeing this reported...not sure if this is the actual limit).  In notebooks (research platform), the chunk size can be adjusted (via the 
<code>chunksize</code> parameter), but in the backtester it is fixed at 6 months.  Presumably, when an algo is run live, there&#39;s no chunking at all, and so one gains back the 6x20 = 120 factor in memory utilization?  If this is the case, it places a rather severe limitation on backtesting compared to live trading.  I don&#39;t understand why Q would allow changing <code>chunksize</code> in notebooks, but not in the backtester.  Does anyone understand this?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdc444444937c003eea4631' id='5cdc444444937c003eea4631'>
<a href='#5cdc444444937c003eea4631'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b5367af91296a14e12b76bd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0f1a8eac15a47d97473d28722fa824e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b5367af91296a14e12b76bd'>Kyle M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557939268000' class='quanto-date posted-at response-posted-at' href='#5cdc444444937c003eea4631'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>I know this was addressed somewhere in the comments above, but there&#39;s likely a memory limitation due to how the pipeline is recalculating days. For example, a factor window of 4 would means for Jan 5 would calculated Jan 5, Jan 4, Jan 3, and Jan 2. Jan 6 would then calculate Jan 6, Jan 5, Jan 4, and Jan 3. </p>

<p>I implemented your N Days Ago factor capability with David&#39;s more efficient pipeline. See here if you&#39;re interested: <a href="https://www.quantopian.com/posts/efficient-n-days-ago-factor-research-and-algo-templates#5ca199d82b596f00422bdd18" rel="nofollow">https://www.quantopian.com/posts/efficient-n-days-ago-factor-research-and-algo-templates#5ca199d82b596f00422bdd18</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdc93a1f2edd3004b6a6eb0' id='5cdc93a1f2edd3004b6a6eb0'>
<a href='#5cdc93a1f2edd3004b6a6eb0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557959585000' class='quanto-date posted-at response-posted-at' href='#5cdc93a1f2edd3004b6a6eb0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Kyle -</p>

<p>So what would need to be changed in my code to make it more memory-efficient?  Or are you saying that it&#39;s just how Pipeline works, and no changes to the code will help reduce the memory usage?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdc961e114e287000b6d639' id='5cdc961e114e287000b6d639'>
<a href='#5cdc961e114e287000b6d639'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b5367af91296a14e12b76bd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0f1a8eac15a47d97473d28722fa824e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b5367af91296a14e12b76bd'>Kyle M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1557960222000' class='quanto-date posted-at response-posted-at' href='#5cdc961e114e287000b6d639'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The notebook and algo are set up to automatically combine the pipeline data into the format yours is already outputting. Basically, there&#39;s the initial pipeline that pulls the first N days of data, then the normal pipeline pulls individual day data. Some pandas merging, etc. takes place, and the result are alphas in the form based on your work.</p>

<p>So in terms of changing your code, I&#39;d recommend restructuring it to be like the templates I posted, or, copy your factors into the template and add in your alpha combination via clustering, etc. Hope that helps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdc9c4844937c3c7cea45c2' id='5cdc9c4844937c3c7cea45c2'>
<a href='#5cdc9c4844937c3c7cea45c2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1557961800000' class='quanto-date posted-at response-posted-at' href='#5cdc9c4844937c3c7cea45c2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>code to make it more memory-efficient? </p>
</blockquote>

<p>Each step in pipe, if there is filtering for stocks to be returned and setting others aside, a mask progressively becomes a smaller and smaller collection for each of the other factors to be working through. Include the latest newly more lean mask when calling each factor.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdca1f844937c14d8ea49a0' id='5cdca1f844937c14d8ea49a0'>
<a href='#5cdca1f844937c14d8ea49a0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1557963256000' class='quanto-date posted-at response-posted-at' href='#5cdca1f844937c14d8ea49a0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Another tip for memory consumption/execution time. I found that in some case it is better to not compute factors with a window length, but only factor on a given day, then store them in a data frame in context and recompute current factor window average from the data frame. But then it is better in term of execution time (probably due to locality) to have each factor in one series of day (instead of having a series of factor for each day) but it is really relevant when you are fighting for some millisecond :-).</p>

<p>David  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdcca2d763790691cbf2131' id='5cdcca2d763790691cbf2131'>
<a href='#5cdcca2d763790691cbf2131'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1557973549000' class='quanto-date posted-at response-posted-at' href='#5cdcca2d763790691cbf2131'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Also slowdowns are proportional to the number of columns in pipeline output. The dataframe <code>alphas</code> has 200 columns. Grand prize for the most I&#39;ve ever seen. By the way, in those, there are an average of about 4 nans present. (<a href="https://www.quantopian.com/posts/overview-of-pipeline-content-easy-to-add-to-your-backtest" rel="nofollow">log_data()</a>)</p>

<p>Looks like the alphas are all used on this line in a loop:</p>

<p><code>a = alphas.iloc[:,f*N_FACTOR_WINDOW:(f+1)*N_FACTOR_WINDOW].values</code></p>

<p>Length of the resulting <code>alphas_flattened</code> is just 40.<br>
Then <code>alphas</code> also at <code>alphas_current = alphas.ix[:,::N_FACTOR_WINDOW]</code> in the making of <code>combined_alpha</code></p>

<p>Incidentally GK, how on earth did you assemble something this mind-blowing lol. Don&#39;t answer that.</p>

<p>This avoids an unnecessary variable that is large.<br>
<code>return Pipeline(columns = pipeline_columns, screen = universe)</code><br>
In a similar way, even the <code>beta</code> variable can disappear elsewhere.</p>

<p>Sometimes we tend to have a variable used only one other place as a way to remind ourselves what it is. Sometimes using a comment instead can work ok to avoid the extra variable&#39;s consumed memory, for speed.</p>

<p>Use like <code>(alphas_current/weights).sum(axis=1)</code> in place of range loops, same result, faster. Ignores nans. The axis=1 is saying to sum row values in that case I think.</p>

<p>Might be a good time for <a href="https://www.quantopian.com/posts/timing-code" rel="nofollow">timing</a>, tedious to set up but the output is great.</p>

<p>The most significant speed increase would be fewer columns in case there&#39;s some way to move combined_alpha inside pipeline, there&#39;s a factor for that? :)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdd210644937c4ff1ea478b' id='5cdd210644937c4ff1ea478b'>
<a href='#5cdd210644937c4ff1ea478b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1557995782000' class='quanto-date posted-at response-posted-at' href='#5cdd210644937c4ff1ea478b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Kyle M. -</p>

<p>In the code you posted on <a href="https://www.quantopian.com/posts/efficient-n-days-ago-factor-research-and-algo-templates" rel="nofollow">https://www.quantopian.com/posts/efficient-n-days-ago-factor-research-and-algo-templates</a>, you have 3 factors, and:</p>

<pre><code>WINDOW_LENGTH = 5  # trailing window of alpha factors exported to before_trading_start  
</code></pre>

<p>I have 40 factors, and an upper limit of <code>N_FACTOR_WINDOW = 6</code>, beyond which I hit a memory limit.  Doing the scaling, your code should run with <code>WINDOW_LENGTH = 80</code> (given that it only has 3 factors), which it does.  However, if I try <code>WINDOW_LENGTH = 160</code> I get a memory error.  So, your code doesn&#39;t improve the memory management by more than a factor of 2.</p>

<p>I think there&#39;s only two things that would help:</p>

<ol>
<li>Increase the memory available for the relevant steps in the code.<br></li>
<li>Reduce the amount of memory required (e.g. allowing users to reduce the chunk size, trading execution speed for memory, and/or reducing the size of the data stored, by using lower precision values...if you think about it, <code>float64</code> is overkill for an alpha factor ).<br></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cde8829ad954f0043b743a9' id='5cde8829ad954f0043b743a9'>
<a href='#5cde8829ad954f0043b743a9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558087721000' class='quanto-date posted-at response-posted-at' href='#5cde8829ad954f0043b743a9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m bumping into a bit of a mystery.  In the algo I posted above, if I change (in 
<code>factor_pipeline()</code> and <code>beta_pipeline()</code>) to:</p>

<pre><code>universe = (  
        AnnualizedVolatility(mask=QTradableStocksUS())  
        .percentile_between(90,95))  
</code></pre>

<p>I should be able to increase <code>N_FACTOR_WINDOW</code> by ~20X before running out of memory.  However, I get nothing close to 20X; the advantage is only about 2X.</p>

<p>What am I missing?  Shouldn&#39;t reducing the size of the universe free up memory roughly in proportion to the universe size reduction?  Or is there some overhead (either in the Pipeline plumbing and/or my code) that I&#39;m not accounting for?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdea4dad444894002feec8c' id='5cdea4dad444894002feec8c'>
<a href='#5cdea4dad444894002feec8c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558095066000' class='quanto-date posted-at response-posted-at' href='#5cdea4dad444894002feec8c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m now wondering what 
<code>mask</code> actually does in Pipeline?  If it doesn&#39;t control what stocks are read from the database, then it won&#39;t help (much).  If all stocks in the universe are read from the database, including a trailing window of their corresponding data, and a subset is used based on <code>mask</code> then there&#39;s no way to control the memory usage, right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cded691d4448959cafee70d' id='5cded691d4448959cafee70d'>
<a href='#5cded691d4448959cafee70d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1558107793000' class='quanto-date posted-at response-posted-at' href='#5cded691d4448959cafee70d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Try applying mask to percentile_between  </p>

<pre><code>universe = QTradableStocksUS()  
av = AnnualizedVolatility(mask=universe)  
universe = av.percentile_between(90, 95, mask=universe)  
</code></pre>

<p>Or should that last line be <code>universe &amp;=</code> ? Adding to (further limiting) the mask.<br>
<em>As a rule, whenever mask can be added between parens, I add it, just to be sure, like zscore(), rank(), percentile_between(), factors et. al. since it is sometimes essential to avoid processing on all 8000 stocks.</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdf04e3a450830044f3a790' id='5cdf04e3a450830044f3a790'>
<a href='#5cdf04e3a450830044f3a790'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558119651000' class='quanto-date posted-at response-posted-at' href='#5cdf04e3a450830044f3a790'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Blue -</p>

<p>Just tried your suggestion - no difference.  Kinda weird.  I get the impression if one scaled down to even a few stocks using 
<code>mask</code> the trailing window one could export out of Pipeline to <code>before_trading_start</code> would be quite limited.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdf347ed11f220041069412' id='5cdf347ed11f220041069412'>
<a href='#5cdf347ed11f220041069412'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1558131838000' class='quanto-date posted-at response-posted-at' href='#5cdf347ed11f220041069412'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It reduced your <code>factor_pipeline</code> from 2093 stocks to 102. Did you mean it was still mighty slow?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cdf3aa4d0a1260043bd97b2' id='5cdf3aa4d0a1260043bd97b2'>
<a href='#5cdf3aa4d0a1260043bd97b2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558133412000' class='quanto-date posted-at response-posted-at' href='#5cdf3aa4d0a1260043bd97b2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Blue Seahawk -</p>

<p>The issue is not slowness, but hitting a memory limit.  In going from 2090 stocks to 102, I should be able to increase the trailing window of data by ~20X.  I&#39;m only seeing an increase of ~2X  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce63174298f7c4453cb5c28' id='5ce63174298f7c4453cb5c28'>
<a href='#5ce63174298f7c4453cb5c28'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1558589812000' class='quanto-date posted-at response-posted-at' href='#5ce63174298f7c4453cb5c28'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,<br>
Not sure that this is the right place for this, yet here we are...</p>

<p>I modified your algo above to be contest ready...I&#39;ll use it as one of my entries...<br>
Nothing major was done wrt strategy ...  here is what was done:<br>
-Cut out factset simply because I don&#39;t want a year&#39;s holdout...seems artificial to me and more like playing with one hand tied behind your back.<br>
-Cut out other fundamental factors that don&#39;t seem to work anymore due to company balance sheet manipulations.<br>
-Added in risk constraints to pass the contest criteria.<br>
-Filtered the pipeline as was suggested above.<br>
-Ran a 2-year backtest as that is what the contest uses.</p>

<p>Comes out with a good example of what we&#39;re terming a &quot;Phantom Strategy&quot;...Dollar Neutral, Beta Neutral,  etc,<br>
Thanks for publishing your original!<br>
Tearsheet to follow.<br>
alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce631e8208431526dc7c80f' id='5ce631e8208431526dc7c80f'>
<a href='#5ce631e8208431526dc7c80f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1558589928000' class='quanto-date posted-at response-posted-at' href='#5ce631e8208431526dc7c80f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tearsheet for above:  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce65f25298f7c6e0acb61df' id='5ce65f25298f7c6e0acb61df'>
<a href='#5ce65f25298f7c6e0acb61df'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558601509000' class='quanto-date posted-at response-posted-at' href='#5ce65f25298f7c6e0acb61df'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Alan -</p>

<p>Glad you found it useful!  And thanks for sharing!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce6b9221ffc075c2d61a401' id='5ce6b9221ffc075c2d61a401'>
<a href='#5ce6b9221ffc075c2d61a401'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584709c0d105bc4727000072'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fbbdf71510a43bd01dc2b787ecd3c797?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584709c0d105bc4727000072'>luc prieur</a>
</div>
<a UTCms='1558624546000' class='quanto-date posted-at response-posted-at' href='#5ce6b9221ffc075c2d61a401'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Alan for sharing.  </p>

<p>I have coded the algo to run live on Interactive Brokers using the IBPY API and Quandl as data source.  I&#39;d be happy to share with anyone who contributed to this algo.  Private message me for it.</p>

<p>/Luc</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce7aa30e48a4e594a6ac66e' id='5ce7aa30e48a4e594a6ac66e'>
<a href='#5ce7aa30e48a4e594a6ac66e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558686256000' class='quanto-date posted-at response-posted-at' href='#5ce7aa30e48a4e594a6ac66e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>One key thing here is whether or not the clustering provides any benefit.  I just chucked in in there without proving it out.  So, if anyone has evidence, please share it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce7e9b6a6cc2a004974ddfb' id='5ce7e9b6a6cc2a004974ddfb'>
<a href='#5ce7e9b6a6cc2a004974ddfb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1558702518000' class='quanto-date posted-at response-posted-at' href='#5ce7e9b6a6cc2a004974ddfb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Looks very cool. Where do the factors come from, did you code them all up by yourself?  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ce7fd8d96a47a64fc611444' id='5ce7fd8d96a47a64fc611444'>
<a href='#5ce7fd8d96a47a64fc611444'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558707597000' class='quanto-date posted-at response-posted-at' href='#5ce7fd8d96a47a64fc611444'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Thomas -</p>

<p>Thanks for checking it out.  A few factors came from me, but a lot of them I grabbed from forum posts.  I wanted lots of factors to see how it would scale with the number of factors.</p>

<p>The main point here is to do the alpha combination in 
<code>before_trading_start</code> where one has a full 5 minutes, should it be needed.  I also find trying to do computations in Pipeline to be overly complicated/cumbersome, so getting the data out the Q-specific API and into the &quot;real world&quot; for me is an advantage.  Another possibility would be to have some minutely factors in <code>before_trading_start</code> to throw into the mix (I&#39;m not sure this is feasible within Pipeline).</p>

<p>The main problem I see is a memory a memory limitation.  One mystery is that if I use <code>mask</code> to reduce the universe I don&#39;t get a commensurate increase in the available memory (see comments above, <a href="https://www.quantopian.com/posts/alpha-combination-via-clustering#5cdf3aa4d0a1260043bd97b2" rel="nofollow">https://www.quantopian.com/posts/alpha-combination-via-clustering#5cdf3aa4d0a1260043bd97b2</a>).  Is there an explanation for this?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce8c1f47f1d03149269f47d' id='5ce8c1f47f1d03149269f47d'>
<a href='#5ce8c1f47f1d03149269f47d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1558757876000' class='quanto-date posted-at response-posted-at' href='#5ce8c1f47f1d03149269f47d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>About your question on &quot;does clustering helps&quot;.</p>

<p>To answer it, one would need to understand what is clustering and why it has been developed ;-).</p>

<p>In a machine learning point of view, you start with input data and from them you want to perform a prediction. One key element of improving the learning process (so the fit you are doing using your favourite algo (linear regression to NN)) is feature selection. Basically a &quot;feature&quot; is one of the input feeds to your fit. Most of the time if you just take the raw data, you will end up with a poor quality of fit, and therefore a poor quality of predictions. There is endless solutions to preform a feature selection, clustering is one of them. What your algo do, could be understand as follow: </p>

<p>1) starting with N factors.<br>
2) Find how they are clustered<br>
3) for each cluster, define a feature which is the linear combination with equal weight of the element of the cluster (with the weight being 1/N, N being the number of element of the cluster)<br>
4) then the predictor is the linear combination with equal weight of those new features.</p>

<p>To push a bit more your algo, you could try to replace 4) with some fitting method (I would start with something simple as a linear regression, using your feature to fit the returns, but then you might need to use a defined number of cluster maybe for example the x largest...).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce8c4857f1d03004d69f6ab' id='5ce8c4857f1d03004d69f6ab'>
<a href='#5ce8c4857f1d03004d69f6ab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1558758533000' class='quanto-date posted-at response-posted-at' href='#5ce8c4857f1d03004d69f6ab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Oh by the way something to test:<br>
It is not clear if your really need to recompute the clusters every days. Would be interesting to see if  factors which are clustered stay in the same cluster and what is the &quot;typical time of correlation&quot;. If this time is really large, that would allow you to perform the clustering in the research env, then export it as a table in your algo. Or maybe recompute the clustering only every N days. That will leave you some computational time/memory for anything you want to do with the new features...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce915694c9d91004e709137' id='5ce915694c9d91004e709137'>
<a href='#5ce915694c9d91004e709137'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1558779241000' class='quanto-date posted-at response-posted-at' href='#5ce915694c9d91004e709137'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Thomas W. -</p>

<p>If I understand Pipeline correctly, it chunks data reads from disk, and then computes factor values over the entire chunk.  I believe it operates on 6 months of data.  Those data are just sitting in memory, but can&#39;t be accessed in 
<code>before_trading_start</code>.   I&#39;m wondering if when Pipeline chunks, the entire 6-month chunk of computed Pipeline values could be made available to <code>before_trading_start</code> (ideally passing a reference, so that more memory isn&#39;t required in copying the data).  What am I missing?  It seems like one should be able to access the entire 6-month chunk once it is computed.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ce9227c7f1d03149269f722' id='5ce9227c7f1d03149269f722'>
<a href='#5ce9227c7f1d03149269f722'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1558782588000' class='quanto-date posted-at response-posted-at' href='#5ce9227c7f1d03149269f722'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Name of each class for columns should be available something like this:</p>

<pre><code>    for k, f in enumerate(make_factors()):  
        for days_ago in range(N_FACTOR_WINDOW):  
            pipeline_columns[f.__name__+&#39;_&#39;+str(days_ago)] = Factor_N_Days_Ago([f(mask=m)], window_length=days_ago+1, mask=m)  
</code></pre>

<p>The variable chunksize is an optional argument in zipline by the way.<br>
Maybe caching given our repeated backtests (so long as changes each time are not to pipeline code) could be worth looking into.</p>

<p>The factors collected from various sources adopted several ways of coping with nans, might be worth the effort to standardize them. </p>

<pre><code>np.absolute((high-low)/close),axis=0)  
v[np.isinf(v)] = np.nan  
values[np.isinf(values)] = np.nan  
np.isnan(results),0,results))  
np.nan_to_num(fcf_yield[-1,:]))  
np.nanmean(close, axis=0)  
np.nanstd(returns, axis=0)  
np.nansum(-p,axis=0))  
ta = np.where(np.isnan(ta), 0, ta)  
np.repeat([np.nan], 6 - len(quarterly_values)),  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceaf1730a6df131a809d28b' id='5ceaf1730a6df131a809d28b'>
<a href='#5ceaf1730a6df131a809d28b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1558901107000' class='quanto-date posted-at response-posted-at' href='#5ceaf1730a6df131a809d28b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I started modifying Allan Coppola&#39;s version of this program. </p>

<p>First, I wanted more time, but could not exceed 4 years without crashing, so limited testing on those 4 years.</p>

<p>Then, I eliminated some of the factors (which were not productive) as well as ignore the stocktwits import. Then modified some of the numbers controlling this trading strategy in order to give it more leeway.</p>

<p>I find the program so restrictive in its constraints that it becomes a real impediment to better results. Nonetheless, the attached notebook does show one can do better, and still fit within the contest&#39;s constraints.</p>

<p>I still want to explore how far I can go. I will try to change the trading mechanics of the thing and see where it all leads.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceaf2b30a6df14c1909cec7' id='5ceaf2b30a6df14c1909cec7'>
<a href='#5ceaf2b30a6df14c1909cec7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1558901427000' class='quanto-date posted-at response-posted-at' href='#5ceaf2b30a6df14c1909cec7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I can already see another book coming out, Guy!!! Did you enter this in the contest already?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceaf64d29f4c80041d0f365' id='5ceaf64d29f4c80041d0f365'>
<a href='#5ceaf64d29f4c80041d0f365'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1558902349000' class='quanto-date posted-at response-posted-at' href='#5ceaf64d29f4c80041d0f365'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@James, not ready for that yet. I want more...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceb1bb964631400437a7484' id='5ceb1bb964631400437a7484'>
<a href='#5ceb1bb964631400437a7484'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1558911929000' class='quanto-date posted-at response-posted-at' href='#5ceb1bb964631400437a7484'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Profitability hit rate of 0.59 is impressive, I&#39;ll give it that (credit mostly going to Grant and Alan - thank you for your generosity!), though some of it could be just due to parameter over-fitting.</p>

<p>Regarding this, in case anyone&#39;s wondering:</p>

<blockquote>
<p>Then modified some of the numbers controlling this trading strategy in<br>
order to give it more leeway.</p>
</blockquote>

<p>Based on the information in the tear-sheet, this likely just includes holding more positions, e.g. MAX_POSITION_SIZE = 0.005, less restrictive turnover constraint, e.g. MIN_TURN = 0.12, and less restrictive Risk constraints, likely just using the default ones, e.g:</p>

<pre><code>    # MAX_RISK_LMT=0.01  
    risk_model_exposure = opt.experimental.RiskModelExposure(  
           context.risk_loadings,  
           version=opt.Newest,  
           # min_momentum=-MAX_RISK_LMT,  
           # max_momentum=MAX_RISK_LMT,  
           # min_size=-MAX_RISK_LMT,  
           # max_size=MAX_RISK_LMT,  
           # min_value=-MAX_RISK_LMT,  
           # max_value=MAX_RISK_LMT,  
           # min_short_term_reversal=-MAX_RISK_LMT,  
           # max_short_term_reversal=MAX_RISK_LMT,  
           # min_volatility=-MAX_RISK_LMT,  
           # max_volatility=MAX_RISK_LMT,  
    )  
    constraints.append(risk_model_exposure)  
</code></pre>

<p>All good moves I think, but nothing so revolutionary that I feel the urge to write a book about it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceb21a064631400407a7477' id='5ceb21a064631400407a7477'>
<a href='#5ceb21a064631400407a7477'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1558913440000' class='quanto-date posted-at response-posted-at' href='#5ceb21a064631400407a7477'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Joakim, I too do not think there is enough stuff to write a book on this one. At least, not yet...</p>

<p>Your assumptions on how I might have increased the performance level while maintaining eligibility to the contest are mainly wrong, well let&#39;s say it: they are all wrong. The optimizer is very restrictive on its own.</p>

<p>What I am doing is playing on the trade mechanics of that strategy. If you can have an edge, on average, per trade, can you increase the number of trades? Since that would do the job.</p>

<p>If you look at the tearsheet, you will notice there were 113,999 trades over a 4-year period. That is about 4 times as much as in Allan&#39;s tearsheet. Even the shorts, on average, are making a profit.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cebfd8664631400407a792e' id='5cebfd8664631400407a792e'>
<a href='#5cebfd8664631400407a792e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1558969734000' class='quanto-date posted-at response-posted-at' href='#5cebfd8664631400407a792e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy,</p>

<p>Since Grant and Alan were generous enough to share code on this aglo and since you don&#39;t think ...&quot;there is enough stuff to write a book on this one. At least, not yet...&quot;, it would only be appropriate on your part to share code of your modifications. Otherwise, community members might get the impression that you are just feeding off other people&#39;s work and just showing off with what you can do while keeping it under wraps. I think the purpose of Grant and Alan sharing code is to try and educate other community members and also get feedback, constructive or otherwise, from more advance users in perhaps a collaborative effort to improve on it. All I see from you Guy are modifications of contributed open source algo code or content from other community members which you try to improve upon and show off but keep to yourself and later becomes the subject of your books. If you want to contribute to the community, share the code.  If the code or idea is your original then there is no problem keeping it to yourself, it&#39;s your IP. Now if you keep your modifications of other people&#39;s algo a secret and later write a book about it or profit from it, don&#39;t you think you should share the bounty to the original author of the algo, at the very least? That is the ethical and right thing to do. Or is this just your style? Guy, I don&#39;t mean to offend you but just need to call you out on this one lest other members will be discouraged to share their code.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cec4bdd64631407a07a757f' id='5cec4bdd64631407a07a757f'>
<a href='#5cec4bdd64631407a07a757f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b32da9a3ef854003ea5ee91'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/30c0b67219231de686d5692739edad32?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b32da9a3ef854003ea5ee91'>David Daverio</a>
</div>
<a UTCms='1558989789000' class='quanto-date posted-at response-posted-at' href='#5cec4bdd64631407a07a757f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@James</p>

<p>Very well said!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cec4df6e31d3e7cc9df0a61' id='5cec4df6e31d3e7cc9df0a61'>
<a href='#5cec4df6e31d3e7cc9df0a61'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1558990326000' class='quanto-date posted-at response-posted-at' href='#5cec4df6e31d3e7cc9df0a61'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Indeed, very well said @James!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cec74605e66560044644835' id='5cec74605e66560044644835'>
<a href='#5cec74605e66560044644835'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1559000160000' class='quanto-date posted-at response-posted-at' href='#5cec74605e66560044644835'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@James, trading strategies are posted to the Quantopian website up to a certain performance level, and not beyond. For instance, if the original version of this strategy was at the level where it could win the contest hands down, it would not have been published.</p>

<p>Moreover, I have not seen any of the high-scoring contest participants publishing their scripts either. Nor have I seen any published non-contest high-performing trading scripts. No one is wondering why? They know.</p>

<p>Once published, for whatever reason, a trading script becomes public domain. Technically, the same as a shareware of old. However, most of the published trading scripts are not worth much as you must also have noticed. </p>

<p>Nonetheless, we do not see published strategies the same way, what is discarded by one might be a gem in the making for someone else, like me, for instance.</p>

<p>Say I take a published trading script as a template, which might be similar to many others, then remove what I think is not needed, am I doing something wrong if I start adding code snippets from some other templates in order to make it more productive? </p>

<p>Note that doing so might change the very nature and purpose of the original program. To such an extent that whatever the original authors&#39; intentions were, (they also used other peoples templates to design their own), they would not recognize what has been done to their script after all the modifications. And as such, from template to template to template, from modifications to modifications, you have what should be considered original work, original IP. Especially if the resulting program does much better than the original script.</p>

<p>I do not look at a trading strategy the same way as most. My interest is in the payoff matrix equations and their derivatives, not factors. In fact, I removed more than half of the factors from the original program. </p>

<p>Mostly, I look at two numbers: the average net profit per trade, and the number of trades. Then I try to find ways to increase both. The rest, to me, is program dÃ©cor.</p>

<p>Just as a teaser, one can do better than what was presented thus far. After all, I might get interested in another book. We&#39;ll see...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ced005918943a004a48fc09' id='5ced005918943a004a48fc09'>
<a href='#5ced005918943a004a48fc09'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1559035993000' class='quanto-date posted-at response-posted-at' href='#5ced005918943a004a48fc09'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It&#39;s not expected that folks would publish algos that perform better than the one I shared.  I&#39;m not really chasing performance, anyway.  The point of the post was to share the structure and the technique of using clustering for assigning factor weights (which, I&#39;m sure is nothing new...for example, the write-up on <a href="https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html" rel="nofollow">https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html</a> shows that clustering will find stocks that one would expect to be similar, so the same should be true of alpha factors).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ced1c27e54ae8431d3387fd' id='5ced1c27e54ae8431d3387fd'>
<a href='#5ced1c27e54ae8431d3387fd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1559043111000' class='quanto-date posted-at response-posted-at' href='#5ced1c27e54ae8431d3387fd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,</p>

<p>While your algo is something that is not new and your purpose is not highlighting performance but rather &quot;share the structure and the technique of using clustering for assigning factor weights&quot;, I am calling out Guy for proper decorum. Proper decorum is what Alan did, modified your algo, posted modified code, credited you and informed everyone that he entered it in the contest. Also Luc, informed everyone that he coded your algo &quot;...to run live on Interactive Brokers using the IBPY API and Quandl as data source. I&#39;d be happy to share with anyone who contributed to this algo.&quot; This is proper decorum. Guy, on the other hand, is just tooting his horn and perhaps another book in the making!</p>

<p>We are loosing the essence of collaborative efforts in learning and exploring ideas in search of alpha,  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceda432e54ae8431d338b37' id='5ceda432e54ae8431d338b37'>
<a href='#5ceda432e54ae8431d338b37'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1559077938000' class='quanto-date posted-at response-posted-at' href='#5ceda432e54ae8431d338b37'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The following two charts result from adding some of my OWN code snippets from my program (the DX-08 version) to Allan&#39;s reduced version of the program.</p>

<p><img src="https://image-proxy.quantopian.com/c86d156f12cd63cae9e39170c7de4ce541bba2e8/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f4445565831302f416c7068615f436c7573746572735f31304d5f32385f30352e706e67" /></p>

<p>Based on the tearsheet, the above is equivalent to a 25.6% CAGR.</p>

<p><img src="https://image-proxy.quantopian.com/1914b1177f084d235be5585578bb267f29967f25/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f4445565831302f416c7068615f436c7573746572735f53746174735f31304d5f32385f30352e706e67" /></p>

<p>The strategy did 123,931 trades over a 4-year period. Enough to say that, on average, the strategy did this or that.</p>

<p>This thing, on purpose, exceeds volatility, turnover, leverage, net dollar-neutral, and sector-neutral exposure constraints. Some, not by much, but still marginally crossing the limits for a few days, up to a few weeks. </p>

<p>However, the strategy does compensate for this by showing a higher performance level even with the Optimize API doing the trading. Notice that the max drawdown was not exceeded, but it came very close. And the 0.13 average volatility should not be considered that excessive.</p>

<p>The program still does not do what I want it to do, and therefore, I would still have other modifications I would like to make. I thought it would be nice to show an intermediary step into the transformation of this trading strategy. </p>

<p>There might not be a book on this one after all. If I do more than 4 years, the program crashes. If I increase the initial capital to $100M, the program crashes. If I increase the number of trades further, the program crashes. This may be due to timeout errors or something.</p>

<p>I wanted to know if the program was scalable. I know it is, but I cannot demonstrate it. I wanted to know how much leverage it could support without breaking down, but I cannot show that either. The program crashes. I find it frustrating. All the time trying to find workarounds. Regardless, that is part of the development cycle. So why complain?</p>

<p>I try to explain what I do. Show the possibilities. I do not look at the portfolio management problem the same way as most here. My interest is in the payoff matrix equations and their derivatives, not factors, not even clusters of factors. It is a major change in perspective.</p>

<p>If you find my books too expensive, you have the equivalent or something close to it freely available on my website. I left enough explanations and clues for anyone to duplicate, in their own way, the same things I do.</p>

<p>And also, as said before: I do not want to be responsible for anyone misusing any of my programs and as a result, lose their money. </p>

<p>Reengineer your programs yourselves then you will be responsible for your own code, that it be good or bad. All I can do is to show what I think is possible using the very same tools you do.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cee43b5ce9b6f00465ee526' id='5cee43b5ce9b6f00465ee526'>
<a href='#5cee43b5ce9b6f00465ee526'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1559118773000' class='quanto-date posted-at response-posted-at' href='#5cee43b5ce9b6f00465ee526'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Guy -</p>

<p>While I&#39;m glad that you are using the code shared here as a springboard, without detailing the changes you made, we aren&#39;t moving the discussion forward per my original intent of the post.  It is clear from your posts above that you were able to improve the algo, and that point is now understood.  Without your code, or at least descriptions of substantive changes, we can all congratulate you on your success, but are left with no clue how what you&#39;ve done relates to code that was shared.  I suggest starting a new discussion thread if you want to continue describing your impressive progress.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ceedbbab649a900413fe8c1' id='5ceedbbab649a900413fe8c1'>
<a href='#5ceedbbab649a900413fe8c1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1559157690000' class='quanto-date posted-at response-posted-at' href='#5ceedbbab649a900413fe8c1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, unfortunately or otherwise, I am dropping this strategy as a no go. It does not pass my battery of acid tests. </p>

<p>I cannot increase the trading interval, the program crashes. How could I find out how it could survive for an extended period of time? Crashing in the future is not an option.</p>

<p>I cannot give it more trades, the program crashes. How could I scale it up? How can I continue reinvesting the ongoing profits if not by trading more, increasing the average net profit per trade, or doing both at the same time?</p>

<p>I cannot scale it up, the program crashes. If I double, or more, the initial stake, the program does not terminate. How could it aspire to a larger initial capital? Again, blowing up in the future is not an option.</p>

<p>I cannot increase leverage that much either, the program crashes. A little leverage allows to progressively trade more and increase the average net profit per trade on the condition of having an average positive edge that more than covers the cost of leveraging. If Quantopian intends to leverage contest strategies up to 4 or even 6 times, this thing will not make it. </p>

<p>My acid tests allow me to know beforehand how a strategy might have behaved under such conditions.</p>

<p>There is no new thread coming up on this one and no book either. As said before: I do not want to be responsible for other peoples&#39; losses, misuse, misunderstanding or misinterpretation of what I do. </p>

<p>Nonetheless, as an interesting point. I was not using clustering as you intended it for this trading script. I was only interested in the daily rebalancing based on 
<code>
TargetWeights  
</code>. The rest to me, technically, was just dÃ©cor. Only wanted to see how <code>
TargetWeights  
</code> behaved since Q has reportedly corrected an existing and long-standing bug in its Optimize API procedures. I chose Allan&#39;s script because it was shorter. And even there, I made it even shorter. Mostly, and overall, it is still not enough.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cfa24c17098f9004575e892' id='5cfa24c17098f9004575e892'>
<a href='#5cfa24c17098f9004575e892'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1559897281000' class='quanto-date posted-at response-posted-at' href='#5cfa24c17098f9004575e892'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Satya -</p>

<p>The idea of using the information coefficient (IC) for factor weighting seems sound, although my hunch is that it is noisy, and so lots of data are needed for it to work.</p>

<p>Overall, unless something is changed with the scalability of the Q backtester, I think this will be a Sisyphean task when dealing with a relatively large number of factors, since one also needs a large trailing window of data for each factor.  One approach would be to look for ways of providing initial values (based on analysis in the research platform), and just do updates in the backtester/trading platform.  An example is <a href="https://en.wikipedia.org/wiki/Exponential_smoothing" rel="nofollow">exponential smoothing</a>, for which one needs only the most recent raw value to do an update of the smoothed value.  There&#39;s no need for the algo to deal with a big-honkin&#39; trailing window of data, if the initial smoothed value is known.  The algo then becomes sensitive to start date (since the initial value would be hard-coded), but this isn&#39;t a show-stopper (unlike a memory limit, which is a killer...the song <a href="https://youtu.be/2ZBtPf7FOoM" rel="nofollow">Killer Queen</a> comes to mind...completely orthogonal, I know, but we gotta accessorize this dry discussion).</p>

<p>My guess is that there are lightweight iterative approximations for a lot of algorithms that typically would require the entire data set for each update.  Might be an area to research...please share if anyone has insights.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cfa70d87098f96b2b75e7fa' id='5cfa70d87098f96b2b75e7fa'>
<a href='#5cfa70d87098f96b2b75e7fa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1559916760000' class='quanto-date posted-at response-posted-at' href='#5cfa70d87098f96b2b75e7fa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, I think the problem starts with the first equation you presented.</p>

<pre><code>alpha_combined = w_0*alpha_0 + w_1*alpha_1 + w_2*alpha_2 + ... + w_M*alpha_M  
</code></pre>

<p>and where you say: â€œ<em>...if a cluster has N alpha factors in it, each factor in the cluster gets a weight of 1/N.</em>â€</p>

<p>The assumptions made imply that each factor has an equal weight. I seriously doubt that. </p>

<p>Each factor in such an equation would turn out to be in decreasing order of importance. And if compared individually, we would see a decaying function of their importance as the number of factors increased. Something like in principle component analysis, the more factors you add, the less they explain the portfolio variance.</p>

<p>If your first 3 factors can explain some 75+% of the stocks price movement, the other 17 you used in your algo would have to share what was left in decreasing order of importance. Note that French-Fama first started with 3 factors and extended to 4 after years of research. I have not seen a paper by them going any further.</p>

<p>If the alpha factors do not have equal weights, the function you propose still stands, but it does change its meaning. It gives the weights all the importance of what is analyzed. </p>

<p>This means that the weights should not be equal by design. They should be correlated to the importance of each factor. The highest weight going to the most significant factor, and from there, in decreasing order. This way the least influential factor would get the least weight of all.</p>

<p>With 5 or 6 factors, it should be sufficient to explain some 95% of price variance. And with all the noise that appears in price movements, it should be considered sufficient to make any point. Trading at this level is not a precise science, the best we can do is make approximations of what might be. Adding 10 components might bring you to a 98% of explained variance, but is it worth it when most of it might be some further analysis of market noise?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cfb708ec5a13d06e0ed452d' id='5cfb708ec5a13d06e0ed452d'>
<a href='#5cfb708ec5a13d06e0ed452d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1559982222000' class='quanto-date posted-at response-posted-at' href='#5cfb708ec5a13d06e0ed452d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Guy -</p>

<p>The inspiration for the algo came from the example <a href="https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html" rel="nofollow">https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html</a> and from clustering examples on Quantopian.  Given a large jumble of factors plucked willy-nilly out of thin air, how should one allocate capital to them?  To your point, a large number of factors should be reduced down to 5 or so super-factors.  One can then decide if each super-factor gets an equal share of the capital, or not; in the example I&#39;ve provided, each super-factor gets the same weight.  And one could tweak the weights within each super-factor, based on some criteria.</p>

<p>Unfortunately, we don&#39;t get to learn how Quantopian is handling their ~40 fund algos (factors).  Presumably, they have explored various alpha combination approaches, and found something workable.  There should be a point of diminishing payback; just adding more algos to a fund that already has ~40 algos may just jack up operational expenses, without commensurate returns, but maybe my intuition is flawed.  We do know, however, that money has flowed into the fund, and into the pockets of authors, per <a href="https://www.quantopian.com/posts/quantopian-business-update" rel="nofollow">https://www.quantopian.com/posts/quantopian-business-update</a>.  So, something must be working.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cfbea69c5a13d191bed4644' id='5cfbea69c5a13d191bed4644'>
<a href='#5cfbea69c5a13d191bed4644'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1560013417000' class='quanto-date posted-at response-posted-at' href='#5cfbea69c5a13d191bed4644'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, let&#39;s try to operate with 40 different strategies with 40 factors each and see what would be implied in such a portfolio. At stake would be 400M in capital, and a single strategy could be considered as either a source of portfolio alpha, a profit factor, a contributor to overall performance and be weighted accordingly. </p>

<p>First, the 10% of the available volume rule would start to greatly interfere with the process. Second, the stock selection process itself would generate quite a few duplicates. Third, going long/short in all these portfolios would add to the duplication of intent. One strategy going long on a stock while the other might be shorting it. Forth, the strategies just as the factors are in decreasing order of importance, and they too should not be treated equally.</p>

<p>It goes like this:</p>

<p>\(\sum (H_1 \cdot \Delta P) &gt; , \dots , &gt; \sum (H_{spy} \cdot \Delta P) &gt; , \dots , &gt; \sum (H_{40} \cdot \Delta P) \)</p>

<p>Each strategy, from 1 to 40, can be ordered by how much they generated over the entire time horizon. Some doing better than the average (SPY), some not. And where holding SPY is somewhere in the lot. </p>

<p>At the start, you can give all strategies equal weights since you will not know what will be the order in which they will finish, but they will finish as an ordered CAGR set, no matter what happened or will happen.</p>

<p>Mostly, the contribution of each strategy to the total outcome will look something like the chart below where each color represents a strategy&#39;s percent contribution to the total.</p>

<p><img src="https://image-proxy.quantopian.com/b888742e754b0530d46c0d71f72bbcffb2b3f58f/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f696d616765732f6469766572732f434147525f436f6e747269627574696f6e5f7074665f3430792e706e67" /></p>

<p>As can be observed, the best performers take most of the action and are responsible for most of the outcome. It also stresses the point that the best strategies of the lot should be weighted more heavily than the others since that would tend to increase overall performance to even higher levels. It also makes the point for highly concentrated portfolios of strategies. The same as with the factors in each strategy. In fact, you could use the same chart structure to analyze factor contributions to a strategy, the chart would be similar to the above. The first few factors would rule the game.</p>

<p>Going forward, you can, every day, order the strategies by their respective performance level. After a short while, you will be able to observe which are leading and which are lagging in performance and change their weighting accordingly. The leading strategies change, then you emphasize the new leaders by increasing their respective weights.</p>

<p>As a side note, I read somewhere that Cohen last year made about 1% return on his total portfolio. I understand that the 250M is just a tiny fraction of the 11B under management. But still, I could not associate that with high performance. It could also explain why those having had an allocation got about 0.11% of what was under management in compensation (so far some $270,000 in total for the group).</p>

<p>Your objective is to design a strategy like the blue one at the bottom in the above chart and not the green one at the top. But, you might not get there by doing the same thing as everybody else. Note that the green one at the top still had a positive return.</p>

<p>The most serious advantage you can have in this game is that you can change your stock allocation at will. Especially going forward and this based on whatever criteria you might consider worthwhile. Technically, the game is in your hands where you can put the emphasis where you think will most benefit the overall outcome of your portfolio that it has a single or a group of strategies.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cfcda9f25266f003e986002' id='5cfcda9f25266f003e986002'>
<a href='#5cfcda9f25266f003e986002'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1560074911000' class='quanto-date posted-at response-posted-at' href='#5cfcda9f25266f003e986002'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Preferential weighting of trailing winners may not work (in fact, due to mean reversion, it could fail miserably).  For example, in a long-only approach, one could pick the top-performing stocks out of each of the industry sectors (e.g. over the last year), or buy sector ETFs and combine them (e.g. by market cap).  Or one could try to pick the best-performing sector ETF, and put all capital into it.  If you are saying chase the winners, good luck.  If it were that simple, we&#39;d all have yachts, airplanes, and sports car collections.</p>

<p>I collected and published 40 factors above, and here&#39;s another one I found recently:</p>

<pre><code>class AverageMonthlyArticleSentiment(CustomFactor):  
    # Economic hypothesis: Article sentiment can reflect the  
    # public&#39;s mood about a given security. In this case, use the past  
    # 30 day&#39;s article sentiment to make decisions for the next 20 trading  
    # days  
        inputs = [sentdex.sentiment_signal]  
        window_length = 30  
        window_safe = True

        def compute(self, today, assets, out, sentiment_signal):  
            out[:] = preprocess(np.nanmean(sentiment_signal, axis=0))  
</code></pre>

<p>You can find others in the public domain, or use factors you&#39;ve devised, and show specifically how you would do the weighting, or at least provide an outline of what would be a successful way of combining them, keeping the risk of over-fitting in check.  I think you are saying just pick 5 of the &quot;best-performing&quot; factors (presumably returns-based ranking) and discard the rest, and periodically re-rank based on performance, and pick a new set of 5 factors.  The problem I see is that one could just end up chasing returns (in analogy with picking the best long-performing stocks or sector ETFs or whatever).  And if the pool of factors has a lot of similarity in it, then the 5 factors could all be drawn from essentially the same underlying factor.</p>

<p>It goes without saying that &quot;the best of your stock selection matters a lot&quot; but without specifics on how the selection is to be done, there is no helpful guidance.</p>

<p>Conceptually, clustering factors by a similarity metric (in analogy to grouping stocks by industry sector) could have potential, in my mind.  You seem to argue that it is a fundamentally bad idea, which is fine, but I&#39;m still at a loss to understand your perspective.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5cfebf7f03d4e31529b11bf8' id='5cfebf7f03d4e31529b11bf8'>
<a href='#5cfebf7f03d4e31529b11bf8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1560199039000' class='quanto-date posted-at response-posted-at' href='#5cfebf7f03d4e31529b11bf8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, the real question is: What has sustainable value in our â€œshort-termâ€ trade decision making? </p>

<p>We could choose any combination of stocks from its humongous tradable universe based on whatever criteria. But, we have this little mathematical problem, we want the stocks we pick to really outperform the market averages in some manner. That it be by outperforming over the long term or by trading on all its price swings for whatever reasons we might devise using anything we find of significance. </p>

<p>The decision making is different when considering short-term price moves. Short-term, there is a lot of randomness in the making of price movements. It needs to be accounted for and dealt with. I consider the degree of randomness in price movements plays a major role in the mechanics of the short-term trade.</p>

<p>Like, I accept a high degree of randomness in stock prices (even 95%+). Evidently, it has its set of implications. For one, I might not know what the price of any stock might be tomorrow (even if the price might be biased upward over the long term). This, whatever criteria I might want to devise or adhere to from some other source. </p>

<p>I opted to just make the bet based on an â€œexcuseâ€ of a parameter that I identify as possibly a medium to long-term drift. I don&#39;t even ask it to be precise, just to have been there in the past. It is after taking the bet that I will manage and game the trade. </p>

<p>Say stock prices are â€œtotallyâ€ random, or almost like it. Then, the wisdom of crowds, machine learning, deep learning, artificial intelligence, indicators, parameters, factors, residuals, principal component analysis, wavelets, multiple regressions, quadratic functions, and on and on, cannot help you decipher a game approaching a heads or tails type of game where upcoming odds and biases even change all the time. </p>

<p>The pure randomness of it all precludes finding anything significant in [sentdex.sentiment_signal] for instance, or in [stocktwits] for that matter. Oh, you could always find something on some past, smoothed, interpreted, tailored and doctored sentiment data. But, going forward that is not the data that will be presented. You will have a new ball game. What was there at some time might not be there the next and there is no way to figure out in advance which is which.</p>

<p>No one on this planet, using whatever tools they had at their disposal, ever beat the game of heads or tails except by pure luck of the draw. Sometimes you win, sometimes you lose, but it does not change your average expectation which remains zero for every long-term game you take. No expected gain, but also no expected loss. </p>

<p>However, the nature of the game changes if you add some long-term drift. It makes it an upward biased game where you can win all the time just by sitting around for a long time.</p>

<p>So, short-term, how should you trade? What kind of decision process will fit your temperament, your style and your understanding of the game?</p>

<p>Say, you can identify the best cluster of similarly behaving stocks. These would be the highest performers in risk-return space. Shouldn&#39;t most of the efforts be concentrated on trading methods that would enhance their respective performance even more?</p>

<p>Note that by changing the set of factors, your clusters will be moving around in risk-return space. And, also, clusters do move around in time relative to others, disassemble, rearrange, even morph as if in other sectors. All things I consider, and more, in the design of a trading strategy.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0359aa1d1f7d004350f3d0' id='5d0359aa1d1f7d004350f3d0'>
<a href='#5d0359aa1d1f7d004350f3d0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1560500650000' class='quanto-date posted-at response-posted-at' href='#5d0359aa1d1f7d004350f3d0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Thomas W. -</p>

<p>Any thoughts on the platform limitations I&#39;ve discussed above?  What sort of feedback are you getting from the <a href="https://factset.quantopian.com/" rel="nofollow">Quantopian Enterprise</a> side of the business?</p>

<p>One thought would be to support backtesting in the research platform in a more flexible way.  The browser-based backtester is really geared toward Quantopian Community, and the contest/fund.  I&#39;d think something more broadly useful to both Q Community and Q Enterprise would be better, integrated into the research platform (e.g. as a module callable within a notebook).  Yes?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0373cd9c16cc4524267f2c' id='5d0373cd9c16cc4524267f2c'>
<a href='#5d0373cd9c16cc4524267f2c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1560507341000' class='quanto-date posted-at response-posted-at' href='#5d0373cd9c16cc4524267f2c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>All I can say is that we are well aware of these limitations with a strong desire to fix them. Thanks for your patience.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5d03788c2695e8443524dedb' id='5d03788c2695e8443524dedb'>
<a href='#5d03788c2695e8443524dedb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1560508556000' class='quanto-date posted-at response-posted-at' href='#5d03788c2695e8443524dedb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Thomas -</p>

<p>I recall that one used to be able to run zipline in a notebook.  Was that functionality removed?  If so, any plans to bring it back, in some form?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d062472390c0d00430f5c16' id='5d062472390c0d00430f5c16'>
<a href='#5d062472390c0d00430f5c16'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1560683635000' class='quanto-date posted-at response-posted-at' href='#5d062472390c0d00430f5c16'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>FYI -</p>

<p><a href="https://www.quantopian.com/posts/zipline-dot-tradingalgorithm-removed-from-research-and-backtesting" rel="nofollow">https://www.quantopian.com/posts/zipline-dot-tradingalgorithm-removed-from-research-and-backtesting</a></p>

<p>It is not possible to run zipline in a notebook, and presumably there are no plans to re-enable this capability.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0bab54df6b84003e57841e' id='5d0bab54df6b84003e57841e'>
<a href='#5d0bab54df6b84003e57841e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c0321c635e865001efc654a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f216e22fe967f493dfb6657de2553438?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c0321c635e865001efc654a'>Zicai Feng</a>
</div>
<a UTCms='1561045844000' class='quanto-date posted-at response-posted-at' href='#5d0bab54df6b84003e57841e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>few cents on the discussion b/w Grant and Guy. Before that, a big disclaimer that both G&amp;G are way smarter than me, and hats off to G No.1 for the initiative and the codes...</p>

<p>re: is say 40 factors in a single strategy too much? probably not. The main benefit for having lots of (uncorrelated) factors is risk reduction in your strategy. Surely some factor will have IR less than half of the strong factors, but if you throw them in a mean-variance op, they will still get some weights due to uncorrelation.   Yes, &quot;40 different strategies with (same?) 40 factors&quot; might be useless, but what Grant is doing is 1 single strategy with 40 factors. It (might) at least max the IR in this single strategy by having a diverse range of uncorrelated factors.  Also, it can actually reduce turnover too. But point taken from Guy&#39;s point that if 5 factors explain 98% of the return, there is no point to add more factors. To address that concern, (and again, this is not what Grant&#39;s initiative was about), one can set a hard cut off such that if a factor X has less than Y% weight in the final mix, then just throw it away and re-normalize the rest of the useful factors so that sum=1. With the computing power nowadays, (no punt intended for the computing limit we are facing in this backtest) there is no harm throwing all your factors (that make sense) into the mix, and let the standard optimizer pick how many factors it likes.</p>

<p>re: best way to assign factor weight? (again, lets remember that Grant is just doing this for academic purpose and for the purpose of letting us to steal his codes, he is not trying to optimize the weights).  the most traditional and still the most acceptable method is max your total expected returns/IC from factors while min the return vol.  So &quot;clustering&quot; is by no mean the best method. In fact, lets remember, most machine learning approaches are just ways for lazy ppl (not Grant, he did the opposite of being lazy here) to come up with a blackbox function, instead of defining the function using pen and paper. In this very case, one probably don&#39;t need ML to define factor groupings, all you need to do is to group them according to value style, momentum style etc.  Having said that, can this clustering approach beat a more static style grouping in certain period? You never know!? Say during a particular period where momentum becomes highly correlated with value, a traditional static style grouping won&#39;t do anything to reduce the risk, but this clustering will automatically reduce the exposure to these factors.</p>

<p>re: some confusion. I think what Guy was implying is a factor momentum approach to up/down weight. It is a whole different topic of discussion. And depends on which schools of quant you graduated from, some love it and some hate it. And it is unlikely there will be any consensus on this....</p>

<p>lastly just on clustering as a method. No ML expert here, but with 10,000 features/dimension for 20 data points, i am concerned that the clustering becomes a random pick. Think the IC approach (IC = rank correlation of one factor&#39;s scores vs another factor&#39;s) makes more sense. If one still wants to integrate ML into this, can try IC approach first (so that it becomes 20 features for each factor, instead of 10000 features, then can cluster it)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0bea145d530724f3b8deb6' id='5d0bea145d530724f3b8deb6'>
<a href='#5d0bea145d530724f3b8deb6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d006935d9e3f00559b5a142'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6312268212784a76cbd73d618b071ff9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d006935d9e3f00559b5a142'>Alderik van der Heyde</a>
</div>
<a UTCms='1561061908000' class='quanto-date posted-at response-posted-at' href='#5d0bea145d530724f3b8deb6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Grant, thanks for sharing your code! I&#39;ve learned a lot from it. </p>

<p>Do you think you could explain what is happening in the preprocessing function? I noticed its called in most of your factors but I can&#39;t really figure out what exactly it does with my minimal knowledge of python/pandas. </p>

<p>def preprocess(a):  </p>

<pre><code>a = a.astype(np.float64)  
a[np.isinf(a)] = np.nan  
a = np.nan_to_num(a - np.nanmean(a))  
a = winsorize(a, limits=[WIN_LIMIT,WIN_LIMIT])  

return preprocessing.scale(a)
</code></pre>

<p>from what i can tell you start by dealing with NaNs? then winsorizing then scaling? what does scale do? is that similar to zscoring? is there a reason you don&#39;t zscore? why is the win limit zero? shouldn&#39;t you have limits so that it gets rid of the outliers?</p>

<p>also could someone explain this snippet of code in your make pipeline?</p>

<p>for k,f in enumerate(factors):<br>
        for days_ago in range(N_FACTOR_WINDOW):<br>
            pipeline_columns[&#39;alpha_&#39;+str(k)+&#39;_&#39;+str(days_ago)] = Factor_N_Days_Ago([f(mask=universe)], window_length=days_ago+1, mask=universe)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0c0c6786285a004952b75a' id='5d0c0c6786285a004952b75a'>
<a href='#5d0c0c6786285a004952b75a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1561070695000' class='quanto-date posted-at response-posted-at' href='#5d0c0c6786285a004952b75a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Alderik -</p>

<pre><code>def preprocess(a):

# convert to np.float64  
a = a.astype(np.float64)  
# replace +/-inf with np.nan  
a[np.isinf(a)] = np.nan  
# subtract the mean (ignoring nans in the mean computation) and then convert remaining nans to zero  
a = np.nan_to_num(a - np.nanmean(a))  
# winsorize to eliminate extreme outliers (set limits to zero to allow extreme values)  
a = winsorize(a, limits=[WIN_LIMIT,WIN_LIMIT])  

# convert to standard z-score  
return preprocessing.scale(a)  
</code></pre>

<p>The code below is iterating over the factors, f, and assigning a integer, k, to each of them.  Then for every day in the look-back window it is creating a Pipeline column with the unique label <em>alpha(k)(days_ago)</em>.</p>

<pre><code>for k,f in enumerate(factors):  
for days_ago in range(N_FACTOR_WINDOW):  
pipeline_columns[&#39;alpha_&#39;+str(k)+&#39;_&#39;+str(days_ago)] = Factor_N_Days_Ago([f(mask=universe)], window_length=days_ago+1, mask=universe)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0c0ef6f0975931f735b44a' id='5d0c0ef6f0975931f735b44a'>
<a href='#5d0c0ef6f0975931f735b44a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d006935d9e3f00559b5a142'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6312268212784a76cbd73d618b071ff9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d006935d9e3f00559b5a142'>Alderik van der Heyde</a>
</div>
<a UTCms='1561071350000' class='quanto-date posted-at response-posted-at' href='#5d0c0ef6f0975931f735b44a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant - </p>

<p>Thanks for the quick response!</p>

<p>Could you provide more of a rationale to why you do those steps for preprocessing? </p>

<p>like why does it need to be a float? why subtract the mean?<br>
Why winsorize and allow extreme values?</p>

<p>Why do you need a column with alpha k day ago?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0c11bbe48541004ae81c62' id='5d0c11bbe48541004ae81c62'>
<a href='#5d0c11bbe48541004ae81c62'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1561072059000' class='quanto-date posted-at response-posted-at' href='#5d0c11bbe48541004ae81c62'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Zicai -</p>

<p>My sense is that there are a lot more degrees of freedom than one might expect.  For example, every company can have unique events that drive its stock price, each industry sector can be subject to its own influences, etc.  The signals are there, but just buried under a lot of noise.  Perhaps it is survivorship bias, but I suspect there is something to Ed Thorp (&quot;In May 1998, Thorp reported that his personal investments yielded an annualized 20 percent rate of return averaged over 28.5 years.&quot;), Warren Buffet and Charlie Munger, and Ray Dalio, to name a few successful folks in this domain.  There is such a thing as skill, I would bet.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5d0c93ccdcf6b7004165d874' id='5d0c93ccdcf6b7004165d874'>
<a href='#5d0c93ccdcf6b7004165d874'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1561105356000' class='quanto-date posted-at response-posted-at' href='#5d0c93ccdcf6b7004165d874'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Alderik -</p>

<pre><code>def preprocess(a):

# convert to np.float64 (I recall encountering a bug, due to mixed data types, and this fixed the bug)  
a = a.astype(np.float64)  
# replace +/-inf with np.nan (simplifies code, by treating infs and nans the same)  
a[np.isinf(a)] = np.nan  
# subtract the mean (ignoring nans in the mean computation) and then convert remaining nans to zero  
# demeans alpha vector and shifts all infs and nans to zero  
a = np.nan_to_num(a - np.nanmean(a))  
# winsorize to eliminate extreme outliers (set limits to zero to allow extreme values)  
# see https://en.wikipedia.org/wiki/Winsorizing  
a = winsorize(a, limits=[WIN_LIMIT,WIN_LIMIT])  

# convert to standard z-score  
# normalizes alpha vector so that all alpha vectors are on same scale and can be compared  
return preprocessing.scale(a)  
</code></pre>

<p>Note that the first subtraction of the mean is really to manage the infs and the nans.  By first de-meaning, then the infs and nans can be set to zero alpha value.  Basically, in the alpha combination, the infs and nans end up carrying no weight, which would seem appropriate.  It is kind of a hack, though--probably not the best practice.</p>

<p>You can play around with different levels of the <code>winsorize</code> limits.  It is easier to see the effect in <code>alphalens</code>.  In the code above, I think I ended up not applying winsorize (by setting the limits to zero) just because I didn&#39;t want to mess with it.  I suspect a little bit of distribution clipping could help.</p>

<p>The trailing alpha values are needed for the clustering routine, which is part of the general alpha combination step (see <a href="https://www.quantopian.com/posts/a-professional-quant-equity-workflow" rel="nofollow">https://www.quantopian.com/posts/a-professional-quant-equity-workflow</a>).  Frankly, I recommend focusing your effort on finding good alpha factors, and not getting too caught up in fancy alpha combination.  In my opinion, Q should just take in individual alpha factors from authors anyway, versus incentivizing them to write full-up algos, but what do I know.  This way, they can take full advantage of their new &quot;signal combination&quot; paradigm--it just makes sense to have access to all of the raw signals if they are to make the most of combining them.  And presumably they have no shortage of computational horsepower to do a proper job in the alpha combination step of the workflow.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/alpha-combination-via-clustering'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/alpha-combination-via-clustering'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#91f7f4f4f5f3f0f2fad1e0e4f0ffe5fee1f8f0ffbff2fefc">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>
