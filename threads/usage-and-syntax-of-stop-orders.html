<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Usage &amp; Syntax Of STOP Orders
</title>
<meta content='Hello Quantopian,Can you confirm the syntax and usage of STOP and STOP LIMIT orders, please? Based on the documentation I would be tempted to use:price = data[stock].close_price  order(stock, 100, stop_price = price * 0.95)  if I wanted to go long 100 shares and sell them if price falls by 5%. But I may not have a very good understanding of stops vs limits.When I test this it seems that I actually need to code:price = data[stock].close_price  order(stock,  100)  order(stock, -100, stop_price...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="VXE5qC05HiwEqAQs+LUGs70Izm8cmLQpSV7PPiT6SSgpF0/lj8/Mz721XR23Wq7HhYbtBmZUoTLLURRUjr8rkw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/usage-and-syntax-of-stop-orders' property='og:url'>
<meta content='Usage &amp; Syntax Of STOP Orders' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/usage-and-syntax-of-stop-orders' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Usage &amp; Syntax Of STOP Orders' property='og:title'>
<meta content='Hello Quantopian,Can you confirm the syntax and usage of STOP and STOP LIMIT orders, please? Based on the documentation I would be tempted to use:price = data[stock].close_price  order(stock, 100, stop_price = price * 0.95)  if I wanted to go long 100 shares and sell them if price falls by 5%. But I may not have a very good understanding of stops vs limits.When I test this it seems that I actually need to code:price = data[stock].close_price  order(stock,  100)  order(stock, -100, stop_price...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/usage-and-syntax-of-stop-orders">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5303a7309c80f57a8a000226'>
<div class='post-container' data-post-id='5303a7309c80f57a8a000226' id='5303a7309c80f57a8a000226'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Usage &amp; Syntax Of STOP Orders</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1392748336000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Usage &amp; Syntax Of STOP Orders&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fusage-and-syntax-of-stop-orders%3Futm_source%3Dwebsite_share%26utm_campaign%3Dusage-and-syntax-of-stop-orders%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fusage-and-syntax-of-stop-orders%3Futm_source%3Dwebsite_share%26utm_campaign%3Dusage-and-syntax-of-stop-orders%26utm_medium%3Dlinkedin&amp;title=Usage+%26+Syntax+Of+STOP+Orders+%28Peter+Cawthron%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/usage-and-syntax-of-stop-orders?utm_source=website_share&amp;utm_campaign=usage-and-syntax-of-stop-orders&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Peter Cawthron" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hello Quantopian,</p>

<p>Can you confirm the syntax and usage of STOP and STOP LIMIT orders, please? Based on the documentation I would be tempted to use:</p>

<pre><code>price = data[stock].close_price  
order(stock, 100, stop_price = price * 0.95)  
</code></pre>

<p>if I wanted to go long 100 shares and sell them if price falls by 5%. But I may not have a very good understanding of stops vs limits.</p>

<p>When I test this it seems that I actually need to code:</p>

<pre><code>price = data[stock].close_price  
order(stock,  100)  
order(stock, -100, stop_price = price * 0.95)  
</code></pre>

<p>which gives me a filled market order and an open stop order. Is this right for my use case?</p>

<p>(AM, please contribute here.)</p>

<p>P.  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>46 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5303bfab1796cae15d000065' id='5303bfab1796cae15d000065'>
<a href='#5303bfab1796cae15d000065'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1392754606000' class='quanto-date posted-at response-posted-at' href='#5303bfab1796cae15d000065'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello AM,</p>

<p>Thanks. I&#39;m paper trading my example above at the moment as follows:</p>

<p><img src="https://lh3.googleusercontent.com/-B6TKv_emKN8/UwPPM4mq_FI/AAAAAAAAASc/NYkLF5oLvz8/w810-h279-no/Positions.jpg" alt=""> </p>

<p>I&#39;ve also attached your example - there are two transactions:</p>

<pre><code>2013-04-18 01:00:00 AAPL    BUY      100    $391.93 $39,193.00  
2013-04-19 01:00:00 AAPL    SELL    -100    $390.64 ($39,064.00)  
</code></pre>

<p>P  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5305217dfdca9f307f00004e' id='5305217dfdca9f307f00004e'>
<a href='#5305217dfdca9f307f00004e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1392845185000' class='quanto-date posted-at response-posted-at' href='#5305217dfdca9f307f00004e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Peter,</p>

<p>Let&#39;s say that you have 100 shares of a stock and you want to take a long position. Then you will need to add them to your portfolio by saying: </p>

<pre><code>order(stock,  100)  
</code></pre>

<p>Now, you want to protect yourself and close the entire position if the stock price falls below the 5% threshold. Then you will add this bit of code below.<br>
<code>
order(stock, -100, stop_price = price * 0.95)  
</code></p>

<p>But keep in mind that elsewhere in your algo, you would have needed to track the price of the stock when you entered the position. You can do it with this statement:</p>

<pre><code>if context.enter == True:  
  context.entered_price = data[context.stock].price  
  log.info(&quot;Price of stock bought is:  &quot; + str(context.entered_price))  
  context.enter = False  
</code></pre>

<p>So your initial notation from your first post (pasted here) is correct, assuming you&#39;re going for a long buy strategy and not shorting.  First you need to open the position, and THEN create a stop order. There indeed will be 2 transactions. </p>

<pre><code>price = data[stock].close_price  
order(stock,  100)  
order(stock, -100, stop_price = price * 0.95)  
</code></pre>

<p>Let me know if that helps!  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5308a0b12bad591470000182' id='5308a0b12bad591470000182'>
<a href='#5308a0b12bad591470000182'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1393074354000' class='quanto-date posted-at response-posted-at' href='#5308a0b12bad591470000182'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Alisa,</p>

<p>Can you elaborate on the mechanics of a stop order as an example, please? Assume I go long with a market order that gets filled. I then place a sell stop at a price 5% below the purchase price. The stop order show as a pending order and is cancelled overnight. Is that correct? Although in paper trading with Quantopian (not IB) or in the backtester the order is not cancelled.</p>

<p>I see two possible scenarios:</p>

<p>(i) the stop order resides on the Quantopian server. When the stop is reached a market order is sent to IB.</p>

<p>or</p>

<p>(ii) the stop order is sent to IB but is still recorded on Quantopian as pending. If the stop is reached a market order is executed. Some communication would be required from IB to alert Quantopian.</p>

<p>In (i) the stop would be triggered by a Nanex price and in (ii) by an IB price. This makes me think (i) is more likely.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53091cfb57f0a4debd000038' id='53091cfb57f0a4debd000038'>
<a href='#53091cfb57f0a4debd000038'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393106173000' class='quanto-date posted-at response-posted-at' href='#53091cfb57f0a4debd000038'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Alisa,</p>

<p>A related question is what if the orders go through per your example above:</p>

<pre><code>price = data[stock].close_price  
order(stock,  100)  
order(stock, -100, stop_price = price * 0.95)  
</code></pre>

<p>Then, at some later point, the shares are sold:</p>

<pre><code>order(stock,  -100)  
</code></pre>

<p>Is the limit order automatically cancelled?  Or will it still be hanging around?  It seems like it would need to be cancelled at the same time that the long position is exited, right?</p>

<p>[EDIT] Well, I&#39;m confused again.  It seems that there would need to be a linkage at IB between the separate orders, so that the limit order is cancelled just after the sell order is confirmed filled.  If the limit order gets cancelled before the fill, then it is risky.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5309fd80937125c6e70001a1' id='5309fd80937125c6e70001a1'>
<a href='#5309fd80937125c6e70001a1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393163650000' class='quanto-date posted-at response-posted-at' href='#5309fd80937125c6e70001a1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>More confusion.  Anony&#39;s logic above would seem to make sense for entering the two orders.  First, the market order is submitted.  Once it is confirmed to be filled, then immediately the limit order is submitted to cover the risk.  Why?  Because, presumably the limit order will be in place at IB immediately, while the market order will only be filled when the market supports the transaction.  So, if both the market and limit orders are submitted simultaneously, then one could end up with a limit order covering a yet-to-be filled market order.</p>

<p>An obvious question is can all of this be done within a single call to handle_data, or will the algorithm need to wait until the next call to handle_data to determine if the market order has been filled, to then submit the limit order?</p>

<p>I&#39;m curious...wouldn&#39;t Interactive Brokers have devised an single order type for this sort of thing?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5309ff5e57f0a40d330001b2' id='5309ff5e57f0a40d330001b2'>
<a href='#5309ff5e57f0a40d330001b2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1393164128000' class='quanto-date posted-at response-posted-at' href='#5309ff5e57f0a40d330001b2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I&#39;m sure we will get some clarification soon. My best guess? Quantopian only send market orders to IB and manage stops and limits on their own server because they use Nanex prices.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='530a88a7edd159c5a4000038' id='530a88a7edd159c5a4000038'>
<a href='#530a88a7edd159c5a4000038'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393199274000' class='quanto-date posted-at response-posted-at' href='#530a88a7edd159c5a4000038'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anony,</p>

<p>I rejiggered your code a bit, and it runs now.  Appears to exhibit the correct behavior, although I haven&#39;t checked it down to the nth detail.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='530b93159cae15e4580002ad' id='530b93159cae15e4580002ad'>
<a href='#530b93159cae15e4580002ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393267480000' class='quanto-date posted-at response-posted-at' href='#530b93159cae15e4580002ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Peter et al,</p>

<p>I&#39;d be happy to further elaborate on my response. </p>

<blockquote>
<p>Can you elaborate on the mechanics of a stop order as an example, please? Assume I go long with a market order that gets filled. I then place a sell stop at a price 5% below the purchase price. The stop order show as a pending order and is cancelled overnight. Is that correct? Although in paper trading with Quantopian (not IB) or in the backtester the order is not cancelled.</p>
</blockquote>

<p>When the market price hits your 5% loss threshold, this will convert the stop-order into a market-order. The order will then be executed as a regular order and attempt to sell your designated shares. You mention &quot;stop order.. cancelled overnight&quot;... that&#39;s almost correct. Let&#39;s imagine this edge-case scenario:</p>

<p>4:00PM - stop-order price is hit and converts order into a market-order. However the market is closed and no more trades can be placed. All open orders are expired at the end of the day, as <a href="https://www.quantopian.com/posts/why-cancel-orders-at-end-of-day">explained in this thread</a>. </p>

<p>9:30AM: The algo is running the next day and looks at the market price. We don&#39;t know what happened overnight. The price could have wildly risen, in this case, the stop-order is no longer valid and it will not attempt to exit the position. Alternatively the price stayed below the threshold, in which case we execute the stop-order and convert it to a market order. We place the order to sell, which can be filled within a few seconds depending on the liquidity. </p>

<p>Either way, your algo is checking your stop-order price against the market price. When the threshold is met, it will place an order to exit the position. </p>

<blockquote>
<p>I see two possible scenarios:<br>
(i) the stop order resides on the Quantopian server. When the stop is reached a market order is sent to IB.<br>
or<br>
ii) the stop order is sent to IB but is still recorded on Quantopian as pending. If the stop is reached a market order is executed. Some communication would be required from IB to alert Quantopian.</p>
</blockquote>

<p>The first scenario is accurate. Our market feed comes from Nanex, which provides the pricing for all positions. The stop order is triggered by the Nanex price, alerts us, and sends the market order to IB for execution. </p>

<p>@Grant:</p>

<p>In my example to Peter I was using a stop-order, not a stop-limit order and I think Anony gave a great description. </p>

<blockquote>
<p>if both the market and limit orders are submitted simultaneously, then one could end up with a limit order covering a yet-to-be filled market order.</p>
</blockquote>

<p>The onus is on the code writer to prevent that scenario from happening - and this would likely get caught during backtesting before deploying to paper or live trading. Your example shows a great way of checking if we&#39;ve filled our position and then setting the stop-order. </p>

<p>I too am a fan of &quot;rejiggered&quot;, I&#39;ll see if I can throw it in sometime :)</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='530bf01b5cf1107eac00004a' id='530bf01b5cf1107eac00004a'>
<a href='#530bf01b5cf1107eac00004a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393291293000' class='quanto-date posted-at response-posted-at' href='#530bf01b5cf1107eac00004a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Alisa,</p>

<p>Sorry for not quite following.  Which order types are sent to Interactive Brokers immediately, and which are held at Quantopian, and triggered by Nanex prices?  Also, which order types stay in place overnight?  And which are cancelled EOD?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='530cbea994e337856b000220' id='530cbea994e337856b000220'>
<a href='#530cbea994e337856b000220'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393344170000' class='quanto-date posted-at response-posted-at' href='#530cbea994e337856b000220'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>When you are paper/live trading with IB the behavior is as follows:</p>

<ul>
<li>Deploy algo to live market<br></li>
<li>algo receives aggregated minute bars using the Nanex price feed that runs handle_data once per minute<br></li>
<li>When an order trigger is hit, the algo sends the order to IB  --  depending on the liquidity, it can be filled within seconds<br></li>
<li>Handle_data() runs again in the next minute and updates any positions and checks for any order triggers</li>
</ul>

<p>Based on this, all order types are triggered by Nanex prices and immediately sent to IB. We do not hold any orders, we pass them right to the broker.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='530d176355a239104a0000a6' id='530d176355a239104a0000a6'>
<a href='#530d176355a239104a0000a6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393366885000' class='quanto-date posted-at response-posted-at' href='#530d176355a239104a0000a6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Alisa,</p>

<p>So, if I understand correctly, only market orders are sent asynchronously to IB and filled ASAP by them.  The other order types are recorded by Quantopian asynchronously:</p>

<blockquote>
<p>limit order: Use order(sid, amount, limit_price=price) to place a limit order. A limit order executes at the specified price or better, if the price is reached.<br>
stop order: Call order(sid, amount, stop_price=price) to place a stop order (also known as a stop-loss order). When the specified price is hit, the order converts into a market order.<br>
stop-limit order: Call order(sid, amount, limit_price=price1, stop_price=price2) to place a stop-limit order. When the specified stop price is hit, the order converts into a limit order.</p>
</blockquote>

<p>However, they are not sent to IB, and are potentially converted to market orders at a minutely frequency, if a trigger condition is met based on Nanex aggregated minutely bars (presumably all OHLC values are used, not just the close to determine the trigger condition).</p>

<p>Also, all market orders sent by Quantopian to IB are good until EOD/market close, when they are cancelled automatically.  Similarly, any orders still at Quantopian (not yet converted to market orders) are cancelled at EOD, as well.</p>

<p>I&#39;ve gathered that get_order, get_open_orders, and cancel_orders are all asynchronous, including providing order status at IB, within the minute.  Or no?</p>

<p>Correct?</p>

<p>Also, what information is returned by get_order and get_open_orders?</p>

<p>[EDIT] If my thinking is correct, a market order would be filled by IB almost immediately, but it would take ~58 more seconds to have an associated stop loss order effectively in place at Quantopian (since it could not be triggered until the next minutely bar).  Seems like one would want the stop loss to go in right after the IB order is filled, right?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5311df173b57a3fa5b00005d' id='5311df173b57a3fa5b00005d'>
<a href='#5311df173b57a3fa5b00005d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393680152000' class='quanto-date posted-at response-posted-at' href='#5311df173b57a3fa5b00005d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m still trying to sort out how all of this works.  I&#39;ve gathered that the only IB order type that Quantopian supports is Market (see <a href="https://www.interactivebrokers.com/en/software/webtraderguide/webtrader/orders/supported_order_types.htm">https://www.interactivebrokers.com/en/software/webtraderguide/webtrader/orders/supported_order_types.htm</a>).  And any market order sent to IB from Quantopian has a Time in Force of Day (it will be automatically cancelled at the end of the trading day).</p>

<p>Regarding orders other than market orders, they are not really orders in the sense that they are not sent to the broker, IB, but rather are managed by Quantopian as an intermediary.  So, in a Quantopian algorithm, this is an order:</p>

<pre><code>order(sid, amount)  
</code></pre>

<p>The other supported &quot;order&quot; types (limit, stop, &amp; stop-limit) are effectively helper functions that use the feed of aggregated Nanex minute bars to decide if a market order should be submitted to IB.  In other words, one could just as well write custom limit, stop, and stop-limit order functions (which would utilize the basic market order, order(sid, amount)).</p>

<p>I&#39;ve tried to sort out the difference between a limit order and a marketable limit order...perhaps someone could clarify.</p>

<p>Here&#39;s a book that may be of interest:</p>

<p>Trading and Exchanges: Market Microstructure for Practitioners by Larry Harris<br>
<a href="http://amzn.com/0195144708">http://amzn.com/0195144708</a></p>

<p><a href="http://raudys.com/kursas/2002%20Trading%20and%20exchanges.pdf">http://raudys.com/kursas/2002%20Trading%20and%20exchanges.pdf</a> (draft)</p>

<p>And another apparently relevant reference:</p>

<p>Order Submission Strategy and the CuriousCase of Marketable Limit Orders<br>
<a href="http://faculty.babson.edu/sirri/research/limit%20orders%20JFQA%20june%202002.pdf">http://faculty.babson.edu/sirri/research/limit%20orders%20JFQA%20june%202002.pdf</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5311e3db3b57a3fa5b00006f' id='5311e3db3b57a3fa5b00006f'>
<a href='#5311e3db3b57a3fa5b00006f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1393681373000' class='quanto-date posted-at response-posted-at' href='#5311e3db3b57a3fa5b00006f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I would really like to know if your understanding is correct.</p>

<p>It seems that if manually trading through IB&#39;s TWS that Stop and Stop Limit orders are simulated by IB as they are not native to the exchange i.e. for NYSE see here: <a href="https://www.interactivebrokers.co.in/en/?f=%2Fen%2Ftrading%2Fexchanges.php%3Fexch%3Dnyse%26amp%3Bshowcategories%3DIND%26amp%3Bib_entity%3Din">https://www.interactivebrokers.co.in/en/?f=%2Fen%2Ftrading%2Fexchanges.php%3Fexch%3Dnyse%26amp%3Bshowcategories%3DIND%26amp%3Bib_entity%3Din</a></p>

<p>But if you are right then Stop, Stop Limit and also Limit orders are additionally simulated by Quantopian. By contrast, and I&#39;m guessing again, it seems that something like IB-Matlab has access to the full range of order types at IB i.e. anything you can manually do in TWS can be done in Matlab.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5311eaa33b57a3fa5b00007c' id='5311eaa33b57a3fa5b00007c'>
<a href='#5311eaa33b57a3fa5b00007c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393683108000' class='quanto-date posted-at response-posted-at' href='#5311eaa33b57a3fa5b00007c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yep...I&#39;ve been getting some offline guidance from Alisa, and gradually, it is sinking in how the Quantopian system works with respect to IB.  One concern (perhaps not valid) is that if one submits a market order, it goes immediately to IB, however, if there is an applicable stop-loss order, it would not be evaluated for another ~ 60 seconds.  I ain&#39;t no trader (obviously), but it would seem better to apply the stop-loss as soon as the market order is filled (and only put a stop-loss in for the fill amount).  There&#39;s another timing issue I just considered, which is that Quantopian does not clarify exactly when the limits are evaluated.  If the evaluation is just before the call to handle_data, and it takes up to 2 seconds for a triggered market order to be filled at IB, then it wouldn&#39;t be until the next call to handle_data that the order status and portfolio are updated (unless they&#39;ve built in some latency in their system to account for the delay).  </p>

<p>--Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5311efff960618cc40000189' id='5311efff960618cc40000189'>
<a href='#5311efff960618cc40000189'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393684480000' class='quanto-date posted-at response-posted-at' href='#5311efff960618cc40000189'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Upon quick scanning, the order management code is here:</p>

<p><a href="https://github.com/quantopian/zipline/blob/master/zipline/finance/blotter.py">https://github.com/quantopian/zipline/blob/master/zipline/finance/blotter.py</a></p>

<p><a href="https://github.com/quantopian/zipline/blob/master/zipline/finance/slippage.py">https://github.com/quantopian/zipline/blob/master/zipline/finance/slippage.py</a></p>

<p>Presumably, under live trading w/ IB, this code is used.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5311f1413b57a3c6bb00008e' id='5311f1413b57a3c6bb00008e'>
<a href='#5311f1413b57a3c6bb00008e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1393684803000' class='quanto-date posted-at response-posted-at' href='#5311f1413b57a3c6bb00008e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>(Funnily enough I wrote <em>check_order_triggers</em> at <a href="https://github.com/quantopian/zipline/blob/master/zipline/finance/slippage.py">https://github.com/quantopian/zipline/blob/master/zipline/finance/slippage.py</a> although Eddie improved it! It&#39;s my only contribution to zipline.)</p>

<p>This topic is interesting. I don&#39;t know if it will happen but I&#39;m hoping to get an IB account by the end of March, for obvious reasons. Once I can run an algo against the paper trading account I will be happier.</p>

<p>This discussion  seems relevant:</p>

<p><a href="https://groups.yahoo.com/neo/groups/TWSAPI/conversations/topics/31158">https://groups.yahoo.com/neo/groups/TWSAPI/conversations/topics/31158</a> </p>

<p>This stands out concerning an algo accessing the IB API or (worse?) an algo running in Quantopian accessing the IB API:</p>

<p><em>Where the exchange doesn&#39;t offer a native stop order, IB usually has a<br>
simulated stop order which automatically does rapid order amendments with<br>
stop-limit orders in the way you described - but much more effectively than<br>
you can do it yourself, because IB are very close to the exchange.</em></p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5311f5e1e437e894b800019e' id='5311f5e1e437e894b800019e'>
<a href='#5311f5e1e437e894b800019e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393685987000' class='quanto-date posted-at response-posted-at' href='#5311f5e1e437e894b800019e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, I think effectively the same thing can be accomplished in Quantopian, with a series of stop orders applied over a series of calls to handle_data, as the applicable market order is filled at IB.  I&#39;ve started to tinker around with code that would accomplish this.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531220d7e437e894b80001e8' id='531220d7e437e894b80001e8'>
<a href='#531220d7e437e894b80001e8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393696984000' class='quanto-date posted-at response-posted-at' href='#531220d7e437e894b80001e8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Anony,</p>

<p>Yes...the idea of a diagram has crossed my mind.</p>

<p>Could you elaborate on the difference between a limit order and a marketable limit order, you mention above?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53122d923b57a3e8bf0000f4' id='53122d923b57a3e8bf0000f4'>
<a href='#53122d923b57a3e8bf0000f4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393700243000' class='quanto-date posted-at response-posted-at' href='#53122d923b57a3e8bf0000f4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Anony,</p>

<p>I&#39;ll have to think about if any of this is relevant in the context of Quantopian.  As I understand, Quantopian will only send market orders to IB, so there will be no &quot;sweeping the book&quot; correct?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531231c8960618cc40000203' id='531231c8960618cc40000203'>
<a href='#531231c8960618cc40000203'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393701322000' class='quanto-date posted-at response-posted-at' href='#531231c8960618cc40000203'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well, I count 1.107 M shares on the Ask side, so the order would be filled completely, but at an average price somewhat above 29.63 (since some shares at the higher price would need to be included).  Correct?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53123aa6960618cc4000021b' id='53123aa6960618cc4000021b'>
<a href='#53123aa6960618cc4000021b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393703591000' class='quanto-date posted-at response-posted-at' href='#53123aa6960618cc4000021b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks...so, back to my question.  I gather that there is no such thing as a marketable limit order in the context of Quantopian.  In other words, there is no way to, say, buy 100 shares of XYZ at or below $10, since the Quantopian limit order isn&#39;t working with the IB book (a Quantopian limit order is, if I understand correctly, more of an algorithm helper function, since I could just write one myself).  I could end up buying at higher than $10, since only a market order is executed at IB.  Correct?</p>

<p>--Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5312412bbce3c49d45000247' id='5312412bbce3c49d45000247'>
<a href='#5312412bbce3c49d45000247'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393705261000' class='quanto-date posted-at response-posted-at' href='#5312412bbce3c49d45000247'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Good point regarding the effective &quot;Quantopian order book.&quot;  They have not detailed the order of precedence of orders from Quantopian to IB, but maybe it is first in, first out?  I think the argument will be that they are not offering HFT, so it just doesn&#39;t matter.</p>

<p>Another thought that occurred to me is that since the Quantopian limit orders are triggered on aggregated Nanex minute bars, wouldn&#39;t it make sense to use the high or low price, rather than the close?  I gather that the close is used.  For example, if I am trying to avoid a loss, I think I&#39;d prefer to use the low price, rather than wait another minute for the close to finally get below my trigger price to sell.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531241ce878a19ac1600021c' id='531241ce878a19ac1600021c'>
<a href='#531241ce878a19ac1600021c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/502ade6a4d4917000200001f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6d01808f0e462a3d13f506d85618f332?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/502ade6a4d4917000200001f'>Rich Frank</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393705424000' class='quanto-date posted-at response-posted-at' href='#531241ce878a19ac1600021c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey all,</p>

<p>Just to clarify, Quantopian does not hold any orders.  We send all orders (even stop/limit orders) immediately to the broker (IB).</p>

<p>-Rich  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='531249abe437e89302000238' id='531249abe437e89302000238'>
<a href='#531249abe437e89302000238'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393707438000' class='quanto-date posted-at response-posted-at' href='#531249abe437e89302000238'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Rich,</p>

<p>Maybe you can clarify.  My understanding (perhaps incorrect) is that although IB supports a variety of order types (e.g. <a href="https://www.interactivebrokers.com/en/software/webtraderguide/webtrader/orders/supported_order_types.htm">https://www.interactivebrokers.com/en/software/webtraderguide/webtrader/orders/supported_order_types.htm</a>), the only order type that is sent to IB from Quantopian is a simple market order.  Triggered orders are managed (&quot;held&quot;) by Quantopian until the trigger is satisfied based on the aggregated Nanex minute bar feed, at which point a market order would be sent to IB from Quantopian.</p>

<p>But again, I&#39;m probably totally confused...</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5312503c0f53a2774e000002' id='5312503c0f53a2774e000002'>
<a href='#5312503c0f53a2774e000002'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/502ade6a4d4917000200001f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6d01808f0e462a3d13f506d85618f332?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/502ade6a4d4917000200001f'>Rich Frank</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393709118000' class='quanto-date posted-at response-posted-at' href='#5312503c0f53a2774e000002'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant, no problem.</p>

<p>As you know, Quantopian supports <a href="https://www.quantopian.com/help#ide-ordering">4 order types</a>, based on the combination of arguments with which your algorithm calls the order method.  Quantopian actually handles all of these order types exactly the same: when an algorithm places an order, it&#39;s sent immediately to IB (with IB&#39;s corresponding order type).  In this way, IB manages all the triggers you mentioned.</p>

<p>So if your algorithm places a limit order, IB will work that limit order for you.</p>

<p>-Rich  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='531251590f53a22a6000000a' id='531251590f53a22a6000000a'>
<a href='#531251590f53a22a6000000a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393709403000' class='quanto-date posted-at response-posted-at' href='#531251590f53a22a6000000a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank Rich,</p>

<p>But what about Alisa&#39;s post above:</p>

<p><strong>When you are paper/live trading with IB the behavior is as follows:<br>
    Deploy algo to live market<br>
    algo receives aggregated minute bars using the Nanex price feed that runs handle_data once per minute<br>
    When an order trigger is hit, the algo sends the order to IB -- depending on the liquidity, it can be filled within seconds<br>
    Handle_data() runs again in the next minute and updates any positions and checks for any order triggers<br>
Based on this, all order types are triggered by Nanex prices and immediately sent to IB. We do not hold any orders, we pass them right to the broker.</strong></p>

<p>Was her description simply incorrect?</p>

<p>Also, from what you are saying, the trigger levels are determined by IB, not Quantopian, correct?</p>

<p>Just trying to figure out what to flush out of my mind, and what should remain.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53125ecaefc731bbf200000b' id='53125ecaefc731bbf200000b'>
<a href='#53125ecaefc731bbf200000b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/502ade6a4d4917000200001f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6d01808f0e462a3d13f506d85618f332?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/502ade6a4d4917000200001f'>Rich Frank</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393712844000' class='quanto-date posted-at response-posted-at' href='#53125ecaefc731bbf200000b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Great questions Grant, and sorry for the confusion.  Yes, that description does have some inaccuracies, or maybe requires a liberal interpretation of the phrase &quot;order trigger.&quot;  And that&#39;s right, Quantopian doesn&#39;t manage any triggers for converting orders, etc - that&#39;s all IB.</p>

<p>To revise Alisa&#39;s description:<br>
Each minute, handle_data will run if there were any trades in your universe (according to the Nanex feed).  If so, and your algorithm decides to place an order via the order method, it goes right to IB.  The next minute, handle_data may run again, and your algo code will be able to see the latest fills and positions from IB when it decides whether to place more orders.</p>

<p>-Rich  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='531261deff40ec84eb000014' id='531261deff40ec84eb000014'>
<a href='#531261deff40ec84eb000014'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393713631000' class='quanto-date posted-at response-posted-at' href='#531261deff40ec84eb000014'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Rich,</p>

<p>And I think that you answered one of my other questions:</p>

<p><a href="https://www.quantopian.com/posts/calls-to-handle-data-every-minute-under-live-trading">https://www.quantopian.com/posts/calls-to-handle-data-every-minute-under-live-trading</a></p>

<p>If I hear you correctly, handle_data will remain event-driven under live trading (and presumably there will be no way to force it to run every minute, other than a work-around such as adding SPY to the universe).</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531267e90f53a23cfd00002c' id='531267e90f53a23cfd00002c'>
<a href='#531267e90f53a23cfd00002c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/502ade6a4d4917000200001f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6d01808f0e462a3d13f506d85618f332?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/502ade6a4d4917000200001f'>Rich Frank</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393715179000' class='quanto-date posted-at response-posted-at' href='#531267e90f53a23cfd00002c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Glad to help.</p>

<p>That&#39;s right - live trading and backtesting behave the same in terms of when handle_data is called: on those minutes when any securities in the algo&#39;s universe were traded.</p>

<p>-Rich  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='53130fc2ff40ec84eb000124' id='53130fc2ff40ec84eb000124'>
<a href='#53130fc2ff40ec84eb000124'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393758147000' class='quanto-date posted-at response-posted-at' href='#53130fc2ff40ec84eb000124'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Rich,</p>

<p>You state above &quot;The next minute, handle_data may run again, and your algo code will be able to see the latest fills and positions from IB when it decides whether to place more orders.&quot;  My interpretation is that Quantopian only polls the current IB state just before each call to handle_data, and then makes the state available to the algorithm, correct?  The algorithm cannot access the current (real-time) IB state within a call to handle_data, correct?</p>

<p>Also, in addition to asynchronous (immediate) ordering, order cancellation instructions are sent asynchronously to IB, as well, correct?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531360ceefc73113ba0001a0' id='531360ceefc73113ba0001a0'>
<a href='#531360ceefc73113ba0001a0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/502ade6a4d4917000200001f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6d01808f0e462a3d13f506d85618f332?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/502ade6a4d4917000200001f'>Rich Frank</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393778895000' class='quanto-date posted-at response-posted-at' href='#531360ceefc73113ba0001a0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Yes, that&#39;s exactly the behavior you&#39;ll see - the state of the live algorithm&#39;s orders and portfolio will not change for the duration of a call to handle_data, even if the IB state is changing in real-time.</p>

<p>Right, order cancels are sent immediately to IB, just like requests to place new orders.</p>

<p>-Rich  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5344f5596378fc8b5d00012a' id='5344f5596378fc8b5d00012a'>
<a href='#5344f5596378fc8b5d00012a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5119096629bd01120e00010d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd000adc18bab197777ba2b32fa28709?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5119096629bd01120e00010d'>Dave Gilbert</a>
</div>
<a UTCms='1397028187000' class='quanto-date posted-at response-posted-at' href='#5344f5596378fc8b5d00012a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tried a simple test on my IB paper account:</p>

<pre><code>def initialize(context):  
    context.SPY = symbol(&#39;SPY&#39;)  
    context.flag = False


# Will be called on every trade event for the securities you specify.  
def handle_data(context, data):  
    if context.SPY not in data:  
        return  
    log.info(&#39;{}&#39;.format(data[context.SPY].price))  
    if context.flag == False :  
        order(context.SPY, 100)  
        order(context.SPY, -100, stop_price = data[context.SPY].price - 0.03)  
        context.flag = True  
</code></pre>

<p>The original order was filled, as expected, and the &#39;stop&#39; order was recorded as &#39;open&#39; - also as expected.</p>

<p>However, as can be seen from the log, although the stop price was penetrated, no order was executed at IB at that price.<br>
Shouldn&#39;t the &#39;stop&#39; have been executed?</p>

<p>Here is the dashboard and log output:</p>

<p><a href="https://drive.google.com/file/d/0B0d_RbWn3rcLNHpzN2NYb3VmOVE/edit?usp=sharing">dashboard</a>  </p>

<p>LOG</p>

<p>2014-04-08 21:48handle_data:11INFO185.145<br>
2014-04-08 21:49handle_data:11INFO185.185<br>
2014-04-08 21:50handle_data:11INFO185.18<br>
2014-04-08 21:51handle_data:11INFO185.101<br>
2014-04-08 21:52handle_data:11INFO185.11<br>
2014-04-08 21:53handle_data:11INFO185.02<br>
2014-04-08 21:54handle_data:11INFO185.04<br>
2014-04-08 21:55handle_data:11INFO185.058<br>
2014-04-08 21:56handle_data:11INFO185.09<br>
2014-04-08 21:57handle_data:11INFO185.15<br>
2014-04-08 21:58handle_data:11INFO185.189<br>
2014-04-08 21:59handle_data:11INFO185.17<br>
2014-04-08 22:00handle_data:11INFO185.105  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5344fbceb9fe2ac647000138' id='5344fbceb9fe2ac647000138'>
<a href='#5344fbceb9fe2ac647000138'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1397029840000' class='quanto-date posted-at response-posted-at' href='#5344fbceb9fe2ac647000138'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>isn&#39;t that at 4:45pm EST?  (after market) so you&#39;d have to wait until the next day?   also looking at your log,   I don&#39;t see why the stop price shown is 185.12.   since the sale was at 185.10, am I right to assume that your stop should trigger at 185.07?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5345039f6378fca0eb00015f' id='5345039f6378fca0eb00015f'>
<a href='#5345039f6378fca0eb00015f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5119096629bd01120e00010d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd000adc18bab197777ba2b32fa28709?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5119096629bd01120e00010d'>Dave Gilbert</a>
</div>
<a UTCms='1397031840000' class='quanto-date posted-at response-posted-at' href='#5345039f6378fca0eb00015f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Jason,</p>

<p>the algo was run while the market was open - I&#39;m in London at the moment, hence the time difference. </p>

<p>The stop price was set 3c below the purchase price deliberately, so that I could be reasonably sure that the stop-price would be penetrated. The dashboard shows the stop-price as 185.12, the buy-price at   185.10. I assume the small discrepancy is due to commission/slippage? In any event, the log shows the price going as low as 185.02, so the stop order should have executed at IB, right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5345127d65e1a9f580000161' id='5345127d65e1a9f580000161'>
<a href='#5345127d65e1a9f580000161'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1397035647000' class='quanto-date posted-at response-posted-at' href='#5345127d65e1a9f580000161'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dave, iirc all quantopian log times are in UTC.   I thought there was a 5 hour difference from EST to UTC so I thought it was 4:48 EDT  (maybe I&#39;m off by 1 hour due to daylight savings time?)</p>

<p>actually i just checked, and isn&#39;t 21:48 UTC actually 17:48 EDT?   seems after market to me.....  EDIT: sorry eastern usa is EDT, not EST </p>

<p>re the price trigger, yeah if it&#39;s in market it should have triggered.  I&quot;m just wondering why the stop price is 185.12....  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='534519136378fccd92000167' id='534519136378fccd92000167'>
<a href='#534519136378fccd92000167'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5119096629bd01120e00010d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd000adc18bab197777ba2b32fa28709?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5119096629bd01120e00010d'>Dave Gilbert</a>
</div>
<a UTCms='1397037332000' class='quanto-date posted-at response-posted-at' href='#534519136378fccd92000167'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Jason, difference is 6 hrs due to daylight saving time in the UK, so the market was definitely open. The order was filled at price 185.16  at 15:49., stop price 185.12 (difference probably due to commission and slippage, not relevant to this anyway).  At 15:51 price dropped below stop price and stayed there &#39;til 15:57. The stop should have triggered....</p>

<p>UPDATE:<br>
I stopped the algo at 16:41 (10:41 exchange time) on the 9th April. The dashboard was  showing NO POSITIONS(!), and the stop-order was showing CANCELLED.<br>
Logging in to my paper account, I was surprised to see that 100 SPY share were sold at 23:15 (17:15 exchange time) at price 185.02!</p>

<p>SLD 100 SPY Stock   185.02  ARCA    APR 8 23:15:23      1.41        null</p>

<p>Either something is wrong, or I&#39;m misunderstanding how order(security, stop_price=...) is supposed to work.</p>

<p>Please can someone help as I&#39;d really like to add a working stop-loss to my real-money live algo.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5346e839b3f0036e9100032f' id='5346e839b3f0036e9100032f'>
<a href='#5346e839b3f0036e9100032f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1397155899000' class='quanto-date posted-at response-posted-at' href='#5346e839b3f0036e9100032f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dave/Jason,</p>

<p>I copied your code and ran it against an IB paper account today at 2:00PM EDT. The code worked as written, but perhaps not as you intended. </p>

<p>In your code, the &quot;order&quot; and &quot;stop_order&quot; are submitted in the <em>same</em> bar. The price used for the stop_order is the <em>close price of the previous bar</em>.  I imagine you only want to enter the &quot;stop_order&quot; once your order is filled. In that case, you first need to check if there are open orders, log the fill price, and then reference the fill price in your &quot;stop_order&quot; function. </p>

<p>Additionally, you are only logging the close_price. If the stop_order threshold is crossed during the minute bar (for example, as the low_price), the stop order is converted to a market order. but you won&#39;t see the details in the logs! To see the full price range in the minute, I would recommend logging the high, low, and close to understand the behavior. </p>

<p>One final note, the live algorithm dashboard shows the fill price, which is determined by IB. The logs are driven by a real-time pricing data feed from <a href="http://www.nanex.net/nxcore.html">Nanex</a> that is aggregated into one-minute bars. So there may be a couple small discrepancies between the data feed prices, but you will see the IB fill prices for your securities in the dashboard. Hope that helps!</p>

<p>Cheers,<br>
Alisa</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5347d9eaeb8cb7959d000161' id='5347d9eaeb8cb7959d000161'>
<a href='#5347d9eaeb8cb7959d000161'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5119096629bd01120e00010d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd000adc18bab197777ba2b32fa28709?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5119096629bd01120e00010d'>Dave Gilbert</a>
</div>
<a UTCms='1397217772000' class='quanto-date posted-at response-posted-at' href='#5347d9eaeb8cb7959d000161'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Alisa, I understand what u r saying, but my question is why the stop did not trigger when the stop price was clearly touched while the exchange was open and then triggered at 23:15 (17:15 eexchange time). I don&#39;t understand why you say the code is behaving &#39;as written&#39;. am I missing something?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53480dfeeb65e6368100001c' id='53480dfeeb65e6368100001c'>
<a href='#53480dfeeb65e6368100001c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1397231105000' class='quanto-date posted-at response-posted-at' href='#53480dfeeb65e6368100001c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There are a couple possibilities here. First, what are you calling exchange_time? We use NYSE market hours which are from 9:30AM - 4:00PM EDT. </p>

<p>The log output in your original post says 2014-04-08 21:48&quot;. The 21:48 timestamp is in UTC, which is equivalent to 4:48PM EDT and is after market close. Similarly, 23:15 (or 17:15) is after market hours. In the dashboard screenshot, under the orders and fills, you can also see the same timestamp of the bar when the order was submitted.</p>

<p>Your algorithm placed the order as directed, but it is up to the broker (IB) and their routing system to fill the order. If you have questions about IB&#39;s order routing, I would suggest to contact them directly (unfortunately I don&#39;t have those details!). We are using IB&#39;s Smart Order Router algorithm for order execution. Feedback is welcome if another execution algo is preferred!  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='53484cf147bb1204b700003b' id='53484cf147bb1204b700003b'>
<a href='#53484cf147bb1204b700003b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5119096629bd01120e00010d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd000adc18bab197777ba2b32fa28709?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5119096629bd01120e00010d'>Dave Gilbert</a>
</div>
<a UTCms='1397247218000' class='quanto-date posted-at response-posted-at' href='#53484cf147bb1204b700003b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>21:48 is 15:48 EDT (as the UK is now on summer time) - see my discussion above with Jason. Quantopian stops outputting prices at 16:00 EDT, which you can see clearly from the log.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53485f2b47bb12bfd700005b' id='53485f2b47bb12bfd700005b'>
<a href='#53485f2b47bb12bfd700005b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1397251885000' class='quanto-date posted-at response-posted-at' href='#53485f2b47bb12bfd700005b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Digging through timezones can make one&#39;s head spin (including mine!), so here is a summary of the algo details:</p>

<ul>
<li>Your log output is in UTC<br></li>
<li>Your dashboard screenshot shows your laptop time, which is the Johannesburg timezone<br></li>
<li>The algorithm was deployed at 3:48PM EDT with order price of $185.145, meaning the stop_order price was $185.115<br></li>
<li>Your IB dashboard reported the stop order was filled at 5:15 EDT<br></li>
</ul>

<p>Now that we have the correct timezones and sequence of events, it indeed looks strange that the order was not filled.  What it looks like is that the order was sent to IB as we&#39;d expect, but IB didn&#39;t fill it.  What&#39;s even more odd is that every order we send to IB is sent with an expiration time of market close.  We never expect an order to be filled outside of market hours.</p>

<p>Once we&#39;ve sent an order to IB, it is up to IB to actually fill the order. We do not have control over the order fulfillment. We&#39;ve noticed strange things before in IB&#39;s paper environment.  In other IB paper accounts, both ours and other member&#39;s, they occasionally experience odd behavior. You may have ran into an IB blip. You might call them to explain the situation, but they like to spend their time on real money calls, and don&#39;t always worry about paper trading.  </p>

<p>Another possible explanation is that the order was filled as expected, but IB was slow to notify/update the dashboard. In either case, IB is the right place to ask about the order fill details.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='535099f4280b21a5c3000100' id='535099f4280b21a5c3000100'>
<a href='#535099f4280b21a5c3000100'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51006a5667c86fdb8f0000c8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f06eda103730a21084edee5d79b367a9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51006a5667c86fdb8f0000c8'>Russell Hanson</a>
</div>
<a UTCms='1397791224000' class='quanto-date posted-at response-posted-at' href='#535099f4280b21a5c3000100'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Alisa,</p>

<p>Can you help me to enter OCA -- one cancels all stop/stop limit orders?  </p>

<p>-Russell  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53509b798a7e0ee3cc0000d9' id='53509b798a7e0ee3cc0000d9'>
<a href='#53509b798a7e0ee3cc0000d9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51006a5667c86fdb8f0000c8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f06eda103730a21084edee5d79b367a9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51006a5667c86fdb8f0000c8'>Russell Hanson</a>
</div>
<a UTCms='1397791612000' class='quanto-date posted-at response-posted-at' href='#53509b798a7e0ee3cc0000d9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ugh -- does the above discussion really mean that STOP orders have to be re-submitted everyday because in IB (unlike the backtester, zipline) orders are canceled at the end of the day?</p>

<p>Can someone at Quantopian please implement GTC orders, if only for STOPs? That would be super swell guys!! B)  </p>

<p>Just pass on the the GTC flag to the order in IB and let IB take care of it.  I&#39;m guessing, maybe, this causes some incompatibility with ZipLine.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53557bdd746f39f1bd00012c' id='53557bdd746f39f1bd00012c'>
<a href='#53557bdd746f39f1bd00012c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1398111204000' class='quanto-date posted-at response-posted-at' href='#53557bdd746f39f1bd00012c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Russell,</p>

<p>In live trading, all market orders are submitted to IB with a same-day expiration time of 4PM. This means that any open orders (stop, limit, regular orders) will get cancelled at the end of the trading day. Your algo will enter a new STOP order each day if it wasn&#39;t previously executed. </p>

<p>I saw your private message about OCA orders, which I believe we answered. Let me know if you need anything else!</p>

<p>Alisa  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5355a480b8b77fcab100017d' id='5355a480b8b77fcab100017d'>
<a href='#5355a480b8b77fcab100017d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51006a5667c86fdb8f0000c8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f06eda103730a21084edee5d79b367a9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51006a5667c86fdb8f0000c8'>Russell Hanson</a>
</div>
<a UTCms='1398121602000' class='quanto-date posted-at response-posted-at' href='#5355a480b8b77fcab100017d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is there a &quot;call back&quot; so we can know whether a stop order triggered, or do we have to cycle through open orders ourselves and check the last list of orders vs. the the current?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5359568063335092540002b9' id='5359568063335092540002b9'>
<a href='#5359568063335092540002b9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1398363778000' class='quanto-date posted-at response-posted-at' href='#5359568063335092540002b9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There isn&#39;t an explicit &quot;call back&quot; per se but you can look at the get_order object and see the stop price status. When the stop_price is triggered it will return as True. </p>

<p>Here&#39;s an example of how to check if your stop_price was reached: <a href="https://www.quantopian.com/posts/how-to-set-a-stop-loss-with-a-set-universe">https://www.quantopian.com/posts/how-to-set-a-stop-loss-with-a-set-universe</a>  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/usage-and-syntax-of-stop-orders'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/usage-and-syntax-of-stop-orders'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#5b3d3e3e3f393a38301b2a2e3a352f342b323a3575383436">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>
